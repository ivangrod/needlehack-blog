



<!doctype html>
  <!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Report the temperature with ESP8266 to MQTT - Home Assistant</title>
    <meta name="author" content="Paulus Schoutsen">
    <meta name="description" content="Step by step tutorial to use ESP8266 and a HDC1008 to .">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://www.home-assistant.io/blog/2015/10/11/measure-temperature-with-esp8266-and-report-to-mqtt/">

    <meta property="fb:app_id" content="338291289691179">
    <meta property="og:title" content="Report the temperature with ESP8266 to MQTT">
    <meta property="og:site_name" content="Home Assistant">
    <meta property="og:url" content="https://www.home-assistant.io/blog/2015/10/11/measure-temperature-with-esp8266-and-report-to-mqtt/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="Step by step tutorial to use ESP8266 and a HDC1008 to .">
    <meta property="og:image" content="https://ivangrod.github.io/images/blog/2015-10-esp8266-temp/ha-sensor.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@home_assistant">
    <meta name="twitter:creator" content="@balloob">
    <meta name="twitter:title" content="Report the temperature with ESP8266 to MQTT">
    <meta name="twitter:description" content="Step by step tutorial to use ESP8266 and a HDC1008 to .">
    <meta name="twitter:image" content="https://ivangrod.github.io/images/blog/2015-10-esp8266-temp/ha-sensor.png">
    <link rel="me" href="https://fosstodon.org/@homeassistant">

    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3/dist/style.min.css" rel="stylesheet" />
    <link href="/stylesheets/prism.css?8acb84bc0387c9548a63998fcfea0139" rel="stylesheet">
    <link href="/stylesheets/screen.css?3d79f9acc1b3464b313d68cd5a171ca1" media="screen, projection, print" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Home Assistant" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&amp;family=Instrument+Sans:ital,wdth,wght@0,99,400..700;1,99,400..700&amp;" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  </head>

  <body  class="   blog-post ">
    <header class='site-header '>
      



<div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
      <a href="/needlehack-blog/" class="site-title">
        <div class="logo"></div>
      </a>
      <a class="release-date" href="/blog/2025/09/03/release-20259/" title="Latest version 2025.9.4 released September 19, 2025">
        2025.9.4
      </a>
    </div>

    <div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
      <nav>
        <input type="checkbox" id="toggle" />
        <label
          for="toggle"
          class="toggle"
          data-open="Main Menu"
          data-close="⨉"
        ></label>
        <ul class="menu pull-right">
          <li><a  href="/needlehack-blog/installation/">Getting started</a></li>
          <li>
            <a  href="/needlehack-blog/docs/">Documentation <iconify-icon inline icon='mdi:chevron-down' title='Chevron down'></iconify-icon></a>
            <ul>
              <li><a href="/needlehack-blog/installation/"><iconify-icon inline icon='simple-icons:homeassistant' title='Homeassistant'></iconify-icon> Installation</a></li>
              <li><a href="/needlehack-blog/docs/automation/"><iconify-icon inline icon='mdi:robot-happy' title='Robot happy'></iconify-icon> Automations</a></li>
              <li><a href="/needlehack-blog/dashboards/"><iconify-icon inline icon='mdi:gauge' title='Gauge'></iconify-icon> Dashboards</a></li>
              <li><a href="/needlehack-blog/voice_control/"><iconify-icon inline icon='mdi:comment-processing-outline' title='Comment processing outline'></iconify-icon> Voice assistants</a></li>
              <li><a href="/needlehack-blog/docs/organizing/"><iconify-icon inline icon='mdi:view-grid' title='View grid'></iconify-icon> Device organization</a></li>
              <li><a href="/needlehack-blog/docs/energy/"><iconify-icon inline icon='mdi:solar-power-variant' title='Solar power variant'></iconify-icon> Energy management</a></li>
              <li><a href="/needlehack-blog/docs/configuration/"><iconify-icon inline icon='mdi:cog' title='Cog'></iconify-icon> Advanced configuration</a></li>
            </ul>
          </li>
          <li><a  href="/needlehack-blog/integrations/">Integrations</a></li>
          <li><a class="active" href="/needlehack-blog/blog/">Blog</a></li>
          <li><a  href="/needlehack-blog/help/">Need help?</a></li>
          <li>
            <div class="docsearch" id="docsearch"></div>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

    </header>

    <div class="page-content">

      

      <div class="grid-wrapper">
        <div class="grid grid-center">

          <aside id="toc-bar" class="grid__item desk-wide-one-sixth">
                <section class="aside-module grid__item one-whole">
                  <div class='section'>
                    <h1 class="title epsilon"><iconify-icon inline icon='mdi:toc' title='Toc'></iconify-icon> On this page</h1>
                    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h3"><a href="#components">Components</a></li>
<li class="toc-entry toc-h3"><a href="#alternatives">Alternatives</a></li>
<li class="toc-entry toc-h3"><a href="#connections">Connections</a></li>
<li class="toc-entry toc-h3"><a href="#preparing-your-ide">Preparing your IDE</a></li>
<li class="toc-entry toc-h3"><a href="#sketch">Sketch</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-home-assistant">Configuring Home Assistant</a></li>
</ul>
                  </div>
                </section>
              </aside> 

          
          <div class="grid__item two-thirds desk-wide-seven-twelfths lap-one-whole palm-one-whole">
          

            
              <article class="post">
  
  <header>
  
  <h1>Report the temperature with ESP8266 to MQTT</h1>
  

  
  <div class="meta clearfix">
    

  
  
    <span class="byline author vcard">
      <a href="https://github.com/balloob" target="_blank" rel="external nofollow"><img class="author-avatar" src="https://avatars.githubusercontent.com/balloob?size=64" alt="Paulus Schoutsen"> Paulus Schoutsen<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>
    </span>
  


    









<time datetime="2015-10-11T19:10:00+00:00" pubdate data-updated="true"><iconify-icon inline icon="mdi:calendar" title="Calendar"></iconify-icon> October 11, 2015</time>
    

  <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class="category" href="/blog/categories/esp8266/">ESP8266</a></li>
      
        <li><a class="category" href="/blog/categories/how-to/">How-To</a></li>
      
        <li><a class="category" href="/blog/categories/mqtt/">MQTT</a></li>
      
    
    </ul>
  </span>

    
      <a class="comments" href="#post-comments">Comments</a>
    
  </div>
  
</header>


  <p>{::options coderay_line_numbers=“table” /}</p>
<p>I recently learned about the ESP8266, a $5 chip that includes WiFi and is Arduino compatible. This means that all your DIY projects can now be done for a fraction of the price.</p>
<p>For this tutorial, I’ll walk through how to get going with ESP8266, get the temperature and humidity and report it to MQTT where Home Assistant can pick it up.</p>
<p class="img">
<img src="/images/blog/2015-10-esp8266-temp/setup.png">
Picture of the final setup (+ 2 LED for decoration)
</p>
<p class="img">
<img src="/images/blog/2015-10-esp8266-temp/ha-sensor.png">
Home Assistant will keep track of historical values and allow you to integrate it into automation.
</p>
<a name="read-more"></a>
<h3>Components <a class="title-link" name="components" href="#components"></a>
</h3>
<p>I’ve been using Adafruit for my shopping:</p>
<ul>
<li>
<a href="http://www.adafruit.com/product/2471" rel="external nofollow">Adafruit HUZZAH ESP8266 Breakout<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> (<a href="https://learn.adafruit.com/adafruit-huzzah-esp8266-breakout/assembly" rel="external nofollow">assembly instructions<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>)</li>
<li>
<a href="http://www.adafruit.com/product/2635" rel="external nofollow">Adafruit HDC1008 Temperature &amp; Humidity Sensor Breakout Board<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> (<a href="https://learn.adafruit.com/adafruit-hdc1008-temperature-and-humidity-sensor-breakout/assembly" rel="external nofollow">assembly instructions<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>)</li>
<li><a href="/integrations/mqtt/#picking-a-broker">MQTT server</a></li>
</ul>
<p><em>Besides this, you will need the usual hardware prototype equipment: a breadboard, some wires, soldering iron + wire, Serial USB cable.</em></p>
<h3>Alternatives <a class="title-link" name="alternatives" href="#alternatives"></a>
</h3>
<p>Since this article has been published the HDC1008 has been discontinued. Updated sketches are available for the following alternatives:</p>
<ul>
<li>
<a href="https://www.adafruit.com/product/385" rel="external nofollow">DHT22 sensor<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> and <a href="https://gist.github.com/balloob/1176b6d87c2816bd07919ce6e29a19e9" rel="external nofollow">updated sketch<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>.</li>
<li>
<a href="https://www.adafruit.com/product/2652" rel="external nofollow">BME280 sensor<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> and <a href="https://gist.github.com/mtl010957/9ee85fb404f65e15c440b08c659c0419" rel="external nofollow">updated sketch<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>.</li>
</ul>
<h3>Connections <a class="title-link" name="connections" href="#connections"></a>
</h3>
<p>On your breadboard, make the following connections from your ESP8266 to the HDC1008:</p>
<table>
<thead>
<tr>
<th>ESP8266</th>
<th>HDC1008</th>
</tr>
</thead>
<tbody>
<tr>
<td>GND</td>
<td>GND</td>
</tr>
<tr>
<td>3V</td>
<td>Vin</td>
</tr>
<tr>
<td>14</td>
<td>SCL</td>
</tr>
<tr>
<td>#2</td>
<td>SDA</td>
</tr>
</tbody>
</table>
<p><em>I picked <code>#2</code> and <code>14</code> myself, you can configure them in the sketch.</em></p>
<h3>Preparing your IDE <a class="title-link" name="preparing-your-ide" href="#preparing-your-ide"></a>
</h3>
<p>Follow <a href="https://github.com/esp8266/Arduino#installing-with-boards-manager" rel="external nofollow">these instructions<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> on how to install and prepare the Arduino IDE for ESP8266 development.</p>
<p>After you’re done installing, open the Arduino IDE, in the menu click on <code>sketch</code> -&gt; <code>include library</code> -&gt; <code>manage libraries</code> and install the following libraries:</p>
<ul>
<li>PubSubClient by Nick ’O Leary</li>
<li>Adafruit HDC1000</li>
</ul>
<h3>Sketch <a class="title-link" name="sketch" href="#sketch"></a>
</h3>
<p>If you have followed the previous steps, you’re all set.</p>
<ul>
<li>Open Arduino IDE and create a new sketch (<code>File</code> -&gt; <code>New</code>)</li>
<li>Copy and paste the below sketch to the Arduino IDE</li>
<li>Adjust the values line 6 - 14 to match your setup</li>
<li>Optional: If you want to connect to an MQTT server without a username or password, adjust line 62.</li>
<li>To have the ESP8266 accept our new sketch, we have to put it in upload mode. On the ESP8266 device keep the GPIO0 button pressed while pressing the reset button. The red led will glow half bright to indicate it is in upload mode.</li>
<li>Press the upload button in Arduino IDE</li>
<li>Open the serial monitor (<code>Tools</code> -&gt; <code>Serial Monitor</code>) to see the output from your device</li>
</ul>
<p>This sketch will connect to your WiFi network and MQTT broker. It will read the temperature and humidity from the sensor every second. It will report it to the MQTT server if the difference is &gt; 1 since last reported value. Reports to the MQTT broker are sent with retain set to <code>True</code>. This means that anyone connecting to the MQTT topic will automatically be notified of the last reported value.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;ESP8266WiFi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Wire.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;PubSubClient.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Adafruit_HDC1000.h&gt;</span><span class="cp">
</span>
<span class="cp">#define wifi_ssid "YOUR WIFI SSID"
#define wifi_password "WIFI PASSWORD"
</span>
<span class="cp">#define mqtt_server "YOUR_MQTT_SERVER_HOST"
#define mqtt_user "your_username"
#define mqtt_password "your_password"
</span>
<span class="cp">#define humidity_topic "sensor/humidity"
#define temperature_topic "sensor/temperature"
</span>
<span class="n">WiFiClient</span> <span class="n">espClient</span><span class="p">;</span>
<span class="n">PubSubClient</span> <span class="nf">client</span><span class="p">(</span><span class="n">espClient</span><span class="p">);</span>
<span class="n">Adafruit_HDC1000</span> <span class="n">hdc</span> <span class="o">=</span> <span class="n">Adafruit_HDC1000</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">setup_wifi</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span><span class="n">mqtt_server</span><span class="p">,</span> <span class="mi">1883</span><span class="p">);</span>

  <span class="c1">// Set SDA and SDL ports</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>

  <span class="c1">// Start sensor</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdc</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Couldn't find sensor!"</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup_wifi</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="c1">// We start by connecting to a WiFi network</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Connecting to "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">wifi_ssid</span><span class="p">);</span>

  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">wifi_ssid</span><span class="p">,</span> <span class="n">wifi_password</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"WiFi connected"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">reconnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Loop until we're reconnected</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Attempting MQTT connection..."</span><span class="p">);</span>
    <span class="c1">// Attempt to connect</span>
    <span class="c1">// If you do not want to use a username and password, change next line to</span>
    <span class="c1">// if (client.connect("ESP8266Client")) {</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"ESP8266Client"</span><span class="p">,</span> <span class="n">mqtt_user</span><span class="p">,</span> <span class="n">mqtt_password</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"connected"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed, rc="</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">());</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" try again in 5 seconds"</span><span class="p">);</span>
      <span class="c1">// Wait 5 seconds before retrying</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">checkBound</span><span class="p">(</span><span class="kt">float</span> <span class="n">newValue</span><span class="p">,</span> <span class="kt">float</span> <span class="n">prevValue</span><span class="p">,</span> <span class="kt">float</span> <span class="n">maxDiff</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="n">newValue</span> <span class="o">&lt;</span> <span class="n">prevValue</span> <span class="o">-</span> <span class="n">maxDiff</span> <span class="o">||</span> <span class="n">newValue</span> <span class="o">&gt;</span> <span class="n">prevValue</span> <span class="o">+</span> <span class="n">maxDiff</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="n">lastMsg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">hum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">diff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">reconnect</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span>

  <span class="kt">long</span> <span class="n">now</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">lastMsg</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">lastMsg</span> <span class="o">=</span> <span class="n">now</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">newTemp</span> <span class="o">=</span> <span class="n">hdc</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
    <span class="kt">float</span> <span class="n">newHum</span> <span class="o">=</span> <span class="n">hdc</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">checkBound</span><span class="p">(</span><span class="n">newTemp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">diff</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="n">newTemp</span><span class="p">;</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"New temperature:"</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">temp</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
      <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">temperature_topic</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">temp</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="nb">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">checkBound</span><span class="p">(</span><span class="n">newHum</span><span class="p">,</span> <span class="n">hum</span><span class="p">,</span> <span class="n">diff</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">hum</span> <span class="o">=</span> <span class="n">newHum</span><span class="p">;</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"New humidity:"</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">hum</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
      <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">humidity_topic</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">hum</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="nb">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h3>Configuring Home Assistant <a class="title-link" name="configuring-home-assistant" href="#configuring-home-assistant"></a>
</h3>
<p>The last step is to integrate the sensor values into Home Assistant. This can be done by setting up Home Assistant to connect to the MQTT broker and subscribe to the sensor topics.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml"><span class="na">mqtt</span><span class="pi">:</span>
  <span class="na">broker</span><span class="pi">:</span> <span class="s">YOUR_MQTT_SERVER_HOST</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">your_username</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">your_password</span>

<span class="na">sensor</span><span class="pi">:</span>
  <span class="na">platform</span><span class="pi">:</span> <span class="s">mqtt</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Temperature"</span>
  <span class="na">state_topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sensor/temperature"</span>
  <span class="na">qos</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ºC"</span>

<span class="na">sensor 2</span><span class="pi">:</span>
  <span class="na">platform</span><span class="pi">:</span> <span class="s">mqtt</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Humidity"</span>
  <span class="na">state_topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sensor/humidity"</span>
  <span class="na">qos</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%"</span>
</code></pre></div></div>



</article>

<div id="post-comments"></div>


<div id="discourse-comments"></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://community.home-assistant.io/',
                     discourseEmbedUrl: 'https://www.home-assistant.io/blog/2015/10/11/measure-temperature-with-esp8266-and-report-to-mqtt/' };

  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>

            
          </div>


          
            
              <aside id="sidebar" class="grid__item one-third desk-wide-one-quarter lap-one-whole palm-one-whole">
            
            <div class="grid">
  




  
    
      <section class="sharing aside-module grid__item one-whole lap-one-half">
  <h1 class="title epsilon"><iconify-icon inline icon='mdi:ios-share' title='Ios share'></iconify-icon> Share this post</h1>
  <ul class="divided">
  
    <li>
      <a
        target="_blank"
        href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.home-assistant.io%2Fblog%2F2015%2F10%2F11%2Fmeasure-temperature-with-esp8266-and-report-to-mqtt%2F&text=Report+the+temperature+with+ESP8266+to+MQTT+via+%40home_assistant"
      >Tweet</a>
    </li>
  
  
    <li>
      <a
        target="_blank"
        href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.home-assistant.io%2Fblog%2F2015%2F10%2F11%2Fmeasure-temperature-with-esp8266-and-report-to-mqtt%2F"
      >Share on Facebook</a>
    </li>
  
  </ul>
</section>

      

<section class="recent-posts aside-module grid__item one-whole lap-one-half">
  <h1 class="title epsilon"><iconify-icon inline icon='mdi:newspaper-variant-multiple' title='Newspaper variant multiple'></iconify-icon> Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/blog/2025/09/17/home-assistant-turns-12/">Happy 12th Birthday, Home Assistant!</a>
        </li>
      
    
      
        <li class="post">
          <a href="/blog/2025/09/11/ai-in-home-assistant/">Building the AI-powered local smart home</a>
        </li>
      
    
      
        <li class="post">
          <a href="/blog/2025/09/03/release-20259/">2025.9: Features for tiles and automations for miles</a>
        </li>
      
    
      
        <li class="post">
          <a href="/blog/2025/09/02/frient-joins-works-with-home-assistant/">Frient joins Works with Home Assistant</a>
        </li>
      
    
      
        <li class="post">
          <a href="/blog/2025/08/21/airgradient-joins-works-with-home-assistant/">AirGradient joins Works with Home Assistant</a>
        </li>
      
    
  </ul>
</section>

    
  



  <section id="toc-module" class="aside-module grid__item one-whole lap-one-half">
        <div class='section'>
          <h1 class="title epsilon"><iconify-icon inline icon='mdi:toc' title='Toc'></iconify-icon> On this page</h1>
          <ul id="toc" class="section-nav">
<li class="toc-entry toc-h3"><a href="#components">Components</a></li>
<li class="toc-entry toc-h3"><a href="#alternatives">Alternatives</a></li>
<li class="toc-entry toc-h3"><a href="#connections">Connections</a></li>
<li class="toc-entry toc-h3"><a href="#preparing-your-ide">Preparing your IDE</a></li>
<li class="toc-entry toc-h3"><a href="#sketch">Sketch</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-home-assistant">Configuring Home Assistant</a></li>
</ul>
        </div>
      </section></div>

          </aside>
          
        </div>
      </div>

      <footer>
        <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="skyline grid">
        <div class="skyline grid__item one-whole">
          <div class="footer-skyline">
          </div>
        </div>
      </div>
      <div class="footer-nav grid">
        <div class="company grid__item one-quarter lap-one-half palm-one-whole">
          <div class="title">
            <img
              src="/needlehack-blog/images/footer-logo-text.svg"
              height="72"
              alt="Home Assistant"
            />
          </div>
          <p>
            Home Assistant is a project from the <a href="https://www.openhomefoundation.org/">Open Home Foundation</a>, sponsored by <a href="https://www.nabucasa.com/">Nabu Casa</a>.
          </p>
        </div>

        <div class="grid__item one-quarter lap-one-half palm-one-whole">
          <h3>Join us and contribute!</h3>
          <ul>
            <li><a class="external-link" href="https://github.com/home-assistant/">GitHub repo <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://developers.home-assistant.io">Developers Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://design.home-assistant.io">Design Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://data.home-assistant.io">Data Science Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://community.home-assistant.io">Community Forum <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://creators.home-assistant.io/">Creator Network <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://works-with.home-assistant.io/">Works With Home Assistant <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a href="/needlehack-blog/community">Our community</li>
            <li><a href="/needlehack-blog/help/reporting_issues/">Reporting issues</a></li>
          </ul>
          <h3>System status</h3>
          <ul>
            <li>
              <a class="external-link"  href="https://alerts.home-assistant.io">Integration Alerts <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a>
            </li>
            <li><a href="/needlehack-blog/security/">Security Alerts</a></li>
            <li>
              <a class="external-link" href="https://status.home-assistant.io">System Status <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a>
            </li>
          </ul>
        </div>

        <div class="grid__item one-quarter lap-one-half palm-one-whole">
          <h3>Companion apps</h3>
          <ul>
            <li><a class="external-link" href="https://apps.apple.com/us/app/home-assistant/id1099568401">iOS and Apple devices</a></li>
            <li><a class="external-link" href="https://play.google.com/store/apps/details?id=io.homeassistant.companion.android">Android and Wear OS</a></li>
            <li><a class="external-link" href="https://companion.home-assistant.io/">...and more!</a></li>
          </ul>
          <h3>Governance</h3>
          <ul>
            <li><a href="/needlehack-blog/privacy/">Privacy Notices</a></li>
            <li><a href="/needlehack-blog/developers/cla/">Contributor License Agreement</a></li>
            <li><a href="/needlehack-blog/tos/">Terms of Service</a></li>
            <li><a href="/needlehack-blog/code_of_conduct/">Code of Conduct</a></li>
            <li><a href="/needlehack-blog/developers/credits/">Credits</a></li>
            <li><a href="/needlehack-blog/developers/license/">License</a></li>
          </ul>
        </div>

        <div class="socials grid__item one-quarter lap-one-half palm-one-whole">

          <h3>Follow us</h3>
          <p><a class="external-link" href='https://newsletter.openhomefoundation.org/#/portal'>Sign up for our newsletter <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></p>
          <div class="icons">
            <a
              rel="me"
              href="https://youtube.com/@home_assistant"
              title="YouTube"
              target="_blank"
              ><iconify-icon icon="simple-icons:youtube"></iconify-icon></a>
            <a
              rel="me"
              href="https://reddit.com/r/homeassistant"
              title="Reddit"
              target="_blank"
              ><iconify-icon icon="simple-icons:reddit"></iconify-icon></a>
            <a
              rel="me"
              href="https://github.com/home-assistant/home-assistant"
              title="GitHub"
              target="_blank"
              ><iconify-icon icon="simple-icons:github"></iconify-icon></a>
            <br />
            <a
              rel="me"
              href="https://fosstodon.org/@homeassistant"
              title="Mastodon"
              target="_blank"
              ><iconify-icon icon="simple-icons:mastodon"></iconify-icon></a>
            <a
              rel="me"
              href="https://bsky.app/profile/home-assistant.io"
              title="Bluesky"
              target="_blank"
             ><iconify-icon icon="simple-icons:bluesky"></iconify-icon></a>
            <a
              rel="me"
              href="https://x.com/home_assistant"
              title="X"
              target="_blank"
             ><iconify-icon icon="simple-icons:x"></iconify-icon></a>
            <br />
            <a
              rel="me"
              href="https://www.facebook.com/homeassistantio"
              title="Facebook"
              target="_blank"
              ><iconify-icon icon="simple-icons:facebook"></iconify-icon></a>
            <a
              rel="me"
              href="https://www.instagram.com/homeassistant/"
              title="Instagram"
              target="_blank"
              ><iconify-icon icon="simple-icons:instagram"></iconify-icon></a>
            <a
              rel="me"
              href="https://www.linkedin.com/company/home-assistant"
              title="LinkedIn"
              target="_blank"
              ><iconify-icon icon="simple-icons:linkedin"></iconify-icon></a>
          </div>

          <div class="web-notice">
            <p>
              For partnership inquiries please check out <a href="https://works-with.home-assistant.io/">Works With Home Assistant</a>. For media, get in touch <a href="mailto:media@openhomefoundation.org">here</a>. For other questions, you can contact us <a href="mailto:hello@home-assistant.io">here</a> (No technical support!)
            </p>
            <p>
              Website powered by <a href="https://jekyllrb.com/">Jekyll</a><br />
              Originally based on the <a href="https://github.com/coogie/oscailte">Oscailte theme</a>
            </p>
            <a href="https://www.netlify.com">
              <img
                src="/needlehack-blog/images/frontpage/netlify.svg"
                alt="Deploys by Netlify Badge"
              />
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

      </footer>

    </div>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1.3.1/lite-youtube.js"></script>

<script src="/javascripts/terminology_tooltip.js?274cec0734bc752f0e5ea3d4e2e59858" type="text/javascript" defer></script>

<script src="/javascripts/prism.js?5d6619066a1fc5cd819a93c132b539ac" type="text/javascript" defer></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3/dist/umd/index.min.js"></script>
<script type="text/javascript">
  docsearch({
    container: '#docsearch',
    appId: 'FBHBYS3J0U',
    indexName: 'home-assistant',
    apiKey: "ba6f7e6d97b3d3d2f778978c742a47c6",
  });
  document.querySelector('.site-title').addEventListener('contextmenu', function (ev) {
    ev.preventDefault();
    document.location.assign("https://design.home-assistant.io/#brand/logo")
  });
</script>




<script type="text/javascript">
  {
    const article = document.querySelector("article.post");
    if (article) {
      const iframes = article.querySelectorAll("iframe[data-src]");
      let loaded = false;
      if (iframes) {
        document.addEventListener('mousemove', loadLazyFrames, { passive: true, once: true });
        document.addEventListener('touchmove', loadLazyFrames, { passive: true, once: true });
        document.addEventListener('scroll', loadLazyFrames, { passive: true, once: true });
  
        function loadLazyFrames() {
          if (loaded) return;
          loaded = true;
  
          iframes.forEach((iframe) => {
            const src = iframe.getAttribute("data-src");
            if (src) {
              iframe.setAttribute("src", src);
              iframe.removeAttribute("data-src");
            }
          });
        }
      }
    }
  }
</script>

  </body>
</html>
