



<!doctype html>
  <!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Enphase Envoy - Home Assistant</title>
    <meta name="author" content="Home Assistant">
    <meta name="description" content="Instructions on how to setup Enphase Envoy with Home Assistant.">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://www.home-assistant.io/integrations/enphase_envoy/">

    <meta property="fb:app_id" content="338291289691179">
    <meta property="og:title" content="Enphase Envoy">
    <meta property="og:site_name" content="Home Assistant">
    <meta property="og:url" content="https://www.home-assistant.io/integrations/enphase_envoy/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="Instructions on how to setup Enphase Envoy with Home Assistant.">
    <meta property="og:image" content="https://ivangrod.github.io/images/default-social.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@home_assistant">
    
    <meta name="twitter:title" content="Enphase Envoy">
    <meta name="twitter:description" content="Instructions on how to setup Enphase Envoy with Home Assistant.">
    <meta name="twitter:image" content="https://ivangrod.github.io/images/default-social.png">
    <link rel="me" href="https://fosstodon.org/@homeassistant">

    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3/dist/style.min.css" rel="stylesheet" />
    <link href="/needlehack-blog/stylesheets/prism.css" rel="stylesheet">
    <link href="/needlehack-blog/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Home Assistant" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&amp;family=Instrument+Sans:ital,wdth,wght@0,99,400..700;1,99,400..700&amp;" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  </head>

  <body  class=" integration-page  ">
    <header class='site-header '>
      



<div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
      <a href="/needlehack-blog/" class="site-title">
        <div class="logo"></div>
      </a>
      <a class="release-date" href="/blog/2025/09/03/release-20259/" title="Latest version 2025.9.4 released September 19, 2025">
        2025.9.4
      </a>
    </div>

    <div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
      <nav>
        <input type="checkbox" id="toggle" />
        <label
          for="toggle"
          class="toggle"
          data-open="Main Menu"
          data-close="⨉"
        ></label>
        <ul class="menu pull-right">
          <li><a  href="/needlehack-blog/installation/">Getting started</a></li>
          <li>
            <a  href="/needlehack-blog/docs/">Documentation <iconify-icon inline icon='mdi:chevron-down' title='Chevron down'></iconify-icon></a>
            <ul>
              <li><a href="/needlehack-blog/installation/"><iconify-icon inline icon='simple-icons:homeassistant' title='Homeassistant'></iconify-icon> Installation</a></li>
              <li><a href="/needlehack-blog/docs/automation/"><iconify-icon inline icon='mdi:robot-happy' title='Robot happy'></iconify-icon> Automations</a></li>
              <li><a href="/needlehack-blog/dashboards/"><iconify-icon inline icon='mdi:gauge' title='Gauge'></iconify-icon> Dashboards</a></li>
              <li><a href="/needlehack-blog/voice_control/"><iconify-icon inline icon='mdi:comment-processing-outline' title='Comment processing outline'></iconify-icon> Voice assistants</a></li>
              <li><a href="/needlehack-blog/docs/organizing/"><iconify-icon inline icon='mdi:view-grid' title='View grid'></iconify-icon> Device organization</a></li>
              <li><a href="/needlehack-blog/docs/energy/"><iconify-icon inline icon='mdi:solar-power-variant' title='Solar power variant'></iconify-icon> Energy management</a></li>
              <li><a href="/needlehack-blog/docs/configuration/"><iconify-icon inline icon='mdi:cog' title='Cog'></iconify-icon> Advanced configuration</a></li>
            </ul>
          </li>
          <li><a class="active" href="/needlehack-blog/integrations/">Integrations</a></li>
          <li><a  href="/needlehack-blog/blog/">Blog</a></li>
          <li><a  href="/needlehack-blog/help/">Need help?</a></li>
          <li>
            <div class="docsearch" id="docsearch"></div>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

    </header>

    <div class="page-content">

      

      <div class="grid-wrapper">
        <div class="grid grid-center">

          <aside id="toc-bar" class="grid__item desk-wide-one-sixth">
                <section class="aside-module grid__item one-whole">
                  <div class='section'>
                    <h1 class="title epsilon"><iconify-icon inline icon='mdi:toc' title='Toc'></iconify-icon> On this page</h1>
                    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#supported-devices">Supported devices</a></li>
<li class="toc-entry toc-h2"><a href="#unsupported-devices">Unsupported devices</a></li>
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#configuration">Configuration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#required-manual-input">Required Manual input</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#options">Options</a></li>
<li class="toc-entry toc-h2"><a href="#reconfigure">Reconfigure</a></li>
<li class="toc-entry toc-h2"><a href="#removing-the-integration">Removing the integration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#to-remove-an-integration-instance-from-home-assistant">To remove an integration instance from Home Assistant</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#capabilities">Capabilities</a>
<ul>
<li class="toc-entry toc-h3"><a href="#solar-production-data">Solar production data</a></li>
<li class="toc-entry toc-h3"><a href="#house-consumption-data">House consumption data</a></li>
<li class="toc-entry toc-h3"><a href="#current-transformers">Current Transformers</a></li>
<li class="toc-entry toc-h3"><a href="#grid-sensor-entities">Grid sensor entities</a></li>
<li class="toc-entry toc-h3"><a href="#battery-storage-data">Battery Storage data</a></li>
<li class="toc-entry toc-h3"><a href="#enpower-data">Enpower data</a></li>
<li class="toc-entry toc-h3"><a href="#enpower-load-shedding-relays">Enpower load shedding relays</a></li>
<li class="toc-entry toc-h3"><a href="#iq-meter-collar-data">IQ Meter Collar data</a></li>
<li class="toc-entry toc-h3"><a href="#c6-combiner-controller-data">C6 Combiner Controller data</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#data-polling-interval">Data polling interval</a></li>
<li class="toc-entry toc-h2"><a href="#credentials-or-device-ip-address-update">Credentials or device IP address update</a></li>
<li class="toc-entry toc-h2"><a href="#firmware-updates">Firmware updates</a></li>
<li class="toc-entry toc-h2"><a href="#energy-dashboard">Energy dashboard</a>
<ul>
<li class="toc-entry toc-h3"><a href="#solar-panels">Solar panels</a></li>
<li class="toc-entry toc-h3"><a href="#electricity-grid">Electricity grid</a></li>
<li class="toc-entry toc-h3"><a href="#home-battery-storage">Home battery storage</a></li>
<li class="toc-entry toc-h3"><a href="#individual-devices">Individual devices</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#actions">Actions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#action-switchturn_onswitchturn_offswitchtoggle">Action switch.turn_on/switch.turn_off/switch.toggle</a></li>
<li class="toc-entry toc-h3"><a href="#action-numberset_value">Action number.set_value</a></li>
<li class="toc-entry toc-h3"><a href="#action-selectselect">Action select.select</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#known-issues-and-limitations">Known issues and limitations</a>
<ul>
<li class="toc-entry toc-h3"><a href="#firmware-changes">Firmware changes</a></li>
<li class="toc-entry toc-h3"><a href="#no-battery-controls">No battery controls</a></li>
<li class="toc-entry toc-h3"><a href="#late-reset">Late reset</a></li>
<li class="toc-entry toc-h3"><a href="#energy-incorrect">Energy incorrect</a></li>
<li class="toc-entry toc-h3"><a href="#lifetime-reset">Lifetime reset</a></li>
<li class="toc-entry toc-h3"><a href="#lifetime-energy-production-decreases-by-12-mwh">Lifetime energy production decreases by 1.2 MWh</a></li>
<li class="toc-entry toc-h3"><a href="#missing-inverter-data">Missing inverter data</a></li>
<li class="toc-entry toc-h3"><a href="#missing-inverter-details">Missing inverter details</a></li>
<li class="toc-entry toc-h3"><a href="#summed-voltage">Summed Voltage</a></li>
<li class="toc-entry toc-h3"><a href="#grid-importexport-values-incorrect">Grid Import/Export values incorrect</a></li>
<li class="toc-entry toc-h3"><a href="#balancing-grid-meter">Balancing grid meter</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#troubleshooting">Troubleshooting</a>
<ul>
<li class="toc-entry toc-h3"><a href="#periodic-network-connection-issues">Periodic network connection issues</a></li>
<li class="toc-entry toc-h3"><a href="#ct-active-flag-count-is-non-zero">CT Active flag count is non-zero</a></li>
<li class="toc-entry toc-h3"><a href="#log-entry-for-state-is-not-strictly-increasing">Log entry for state is not strictly increasing</a></li>
<li class="toc-entry toc-h3"><a href="#debug-logs-and-diagnostics">Debug logs and diagnostics</a></li>
</ul>
</li>
</ul>
                  </div>
                </section>
              </aside> 

          
          <div class="grid__item two-thirds desk-wide-seven-twelfths lap-one-whole palm-one-whole">
          

            
              <article class="page">
  
  <header>
    
    
      <div class="breadcrumbs">
        <a href="/needlehack-blog/">Home</a>
        
          
            
            ▸ <a href="/integrations/">Integrations</a>
          
        
          
            ▸ 
          
        
      </div>
    
    <h1 class="title indent">
      
        Enphase Envoy
      
    </h1>
  </header>
  
    
    
    
  
  
  <p>The <strong>Enphase Envoy</strong> <span class="terminology">integration<span class="terminology-tooltip">Integrations connect and integrate Home Assistant with your devices, services, and more.<a class="terminology-link" href="/getting-started/concepts-terminology/#integrations"> [Learn more]</a></span></span> is used to integrate with the <a href="https://enphase.com/en-us/products-and-services/envoy-and-combiner" rel="external nofollow">Enphase IQ Gateway<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a>, a communication device for <a href="https://enphase.com/homeowners" rel="external nofollow">Enphase<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> solar inverters and batteries. In this documentation, as well as in integration entity names, the Enphase IQ Gateway is commonly referred to as <code>Envoy</code>, a name from the conception times of this integration and retained for its compact format.</p>
<h2>Supported devices <a class="title-link" name="supported-devices" href="#supported-devices"></a>
</h2>
<p>The actual model and installed components will determine the available <a href="#capabilities">capabilities</a> and which data can be provided to the <a href="#energy-dashboard">Energy dashboard</a>. The Envoy firmware has <a href="#known-issues-and-limitations">known issues</a> that may come and go as versions change.</p>
<p>This integration works with:</p>
<ul>
<li>Older and newer <abbr title="IQ Gateway">Envoy</abbr> models that only have production metrics (such as Envoy-R (LCD), Envoy-S (not metered))</li>
<li>Newer <abbr title="IQ Gateway">Envoy</abbr> models that offer both production and consumption metrics (such as Envoy-S Metered equipped with <abbr title="current transformers">CT</abbr>).</li>
<li>Various Enphase IQ Combiner products that have an embedded <abbr title="IQ Gateway">Envoy</abbr>, it will show-up in the same way as the stand-alone one.</li>
</ul>
<h2>Unsupported devices <a class="title-link" name="unsupported-devices" href="#unsupported-devices"></a>
</h2>
<p>This integration does not work with:</p>
<ul>
<li>Older Envoy models running firmware before 3.9 which lack a REST API.</li>
</ul>
<h2>Prerequisites <a class="title-link" name="prerequisites" href="#prerequisites"></a>
</h2>
<ul>
<li>The <abbr title="IQ Gateway">Envoy</abbr> must be configured and commissioned.</li>
<li>The <abbr title="IQ Gateway">Envoy</abbr> must be on your local network with IPV4 connectivity from Home Assistant. (Also See troubleshooting, <a href="#periodic-network-connection-issues">periodic network connection issues</a>)</li>
<li>
<abbr title="IQ Gateway">Envoy</abbr> firmware version 3.9 or newer.</li>
<li>With <abbr title="IQ Gateway">Envoy</abbr> firmware 7 and greater:
<ul>
<li>an Enlighten cloud username and password.</li>
<li>Home Assistant 2023.9 or newer.</li>
</ul>
</li>
</ul>
<h2>Configuration <a class="title-link" name="configuration" href="#configuration"></a>
</h2>
<p>To add the <strong>Enphase Envoy</strong> integration to your Home Assistant instance, use this My button:</p>
<p><a href="https://my.home-assistant.io/redirect/config_flow_start?domain=enphase_envoy" class="my badge" target="_blank"><img src="https://my.home-assistant.io/badges/config_flow_start.svg"></a></p>
<p>Enphase Envoy can be auto-discovered by Home Assistant. If an instance was found,
it will be shown as <strong>Discovered</strong>. You can then set it up right away.</p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span><iconify-icon inline icon="mdi:cursor-hand"></iconify-icon> Manual configuration steps</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_0">
<p>If it wasn’t discovered automatically, don’t worry! You can set up a
manual integration entry:</p>
<ul>
<li>
<p>Browse to your Home Assistant instance.</p>
</li>
<li>
<p>Go to <strong><a href="https://my.home-assistant.io/redirect/integrations" class="my" target="_blank"><iconify-icon inline icon="mdi:devices"></iconify-icon> Settings &gt; Devices &amp; Services</a></strong>.</p>
</li>
<li>
<p>In the bottom right corner, select the
<strong><a href="https://my.home-assistant.io/redirect/config_flow_start?domain=enphase_envoy" class="my" target="_blank"><iconify-icon inline icon="mdi:plus"></iconify-icon> Add Integration</a></strong> button.</p>
</li>
<li>
<p>From the list, select <strong>Enphase Envoy</strong>.</p>
</li>
<li>
<p>Follow the instructions on screen to complete the setup.</p>
</li>
</ul>
</div>
  </details>
</div>
<h3>Required Manual input <a class="title-link" name="required-manual-input" href="#required-manual-input"></a>
</h3>
<p>The configuration of an individual Envoy requires you to enter the following information:</p>
<div class="config-vars basic">
  <div class="">
<div class="config-vars-item">
<div class="config-vars-label">
<span class="config-vars-label-name">Host</span><a name="host" class="title-link" href="#host"></a>
</div>
<div class="config-vars-description-and-children"><span class="config-vars-description"><p>The name or IP address of the Envoy to configure. <br> Will be pre-filled if the Envoy was auto-discovered</p>
</span></div>
</div>
<div class="config-vars-item">
<div class="config-vars-label">
<span class="config-vars-label-name">Username</span><a name="username" class="title-link" href="#username"></a>
</div>
<div class="config-vars-description-and-children"><span class="config-vars-description"><p>For firmware version 7.0 and later, enter your Enlighten cloud username. The Enlighten cloud username (and password) will be used to obtain a 1-year-valid token from the enphase web-site when first configured or upon expiry. <br> For firmware before 7.0, enter username <em>installer</em> without a password.</p>
</span></div>
</div>
<div class="config-vars-item">
<div class="config-vars-label">
<span class="config-vars-label-name">Password</span><a name="password" class="title-link" href="#password"></a>
</div>
<div class="config-vars-description-and-children"><span class="config-vars-description"><p>For firmware version 7.0 and later, enter your Enlighten cloud password <br> For firmware before 7.0, with username <em>installer</em>, leave blank.</p>
</span></div>
</div>
</div>
</div>
<h2>Options <a class="title-link" name="options" href="#options"></a>
</h2>
<p>Options for Enphase Envoy can be set via the user interface, by taking the following steps:</p>
<ul>
<li>Browse to your Home Assistant instance.</li>
<li>Go to <strong><a href="https://my.home-assistant.io/redirect/integrations" class="my" target="_blank">Settings &gt; Devices &amp; Services</a></strong>.</li>
<li>If multiple instances of Enphase Envoy are configured, choose the instance you want to configure.</li>
<li>Select the integration, then select <strong>Configure</strong>.</li>
</ul>
<p>Options to enable/disable are listed below. Neither of these are set by default nor need to be set for proper functioning of the integration. Setting these options is only required in described circumstances.</p>
<div class="config-vars basic">
  <div class="">
<div class="config-vars-item">
<div class="config-vars-label">
<span class="config-vars-label-name">Collect test fixture data in diagnostics report</span><a name="collect-test-fixture-data-in-diagnostics-report" class="title-link" href="#collect-test-fixture-data-in-diagnostics-report"></a>
</div>
<div class="config-vars-description-and-children"><span class="config-vars-description"><p>No/Yes <br> When new features are requested or firmware is upgraded, it can happen that existing test fixtures no longer cover all test cases and new ones are needed. You may be requested to provide data for such test fixtures. If so, and you are willing to provide the data, setting this option enables the collection of test data as part of the <a href="#fixtures">diagnostics report</a>.</p>
</span></div>
</div>
<div class="config-vars-item">
<div class="config-vars-label">
<span class="config-vars-label-name">Always use a new connection when requesting data from the Envoy</span><a name="always-use-a-new-connection-when-requesting-data-from-the-envoy" class="title-link" href="#always-use-a-new-connection-when-requesting-data-from-the-envoy"></a>
</div>
<div class="config-vars-description-and-children"><span class="config-vars-description"><p>No/Yes <br> Some older Envoy firmware may exhibit connection issues when using the default keep-alive connection and report failures. When set, this option disables the use of keep-alive and builds a new connection at each data request. This makes the communication more reliable for these firmware versions. Reported for the Envoy-R, but may apply to other older firmware versions as well.</p>
</span></div>
</div>
</div>
</div>
<h2>Reconfigure <a class="title-link" name="reconfigure" href="#reconfigure"></a>
</h2>
<p>This integration supports updating the Envoy configuration through a <code>reconfigure</code> menu option. The reconfiguration allows for changing the Envoy IP address, username, and/or password. Use this menu option if your Enlighten credentials or the device’s IP address has changed and needs to be manually updated. The latter is typically automatically detected and updated.</p>
<p>Use this menu option also when an Envoy firmware upgrade requires a switch from local Envoy username/password to token-based authentication with Enlighten username/password (refer to <a href="#required-manual-input">required manual input</a>).</p>
<h2>Removing the integration <a class="title-link" name="removing-the-integration" href="#removing-the-integration"></a>
</h2>
<p>This integration follows standard integration removal. No extra steps are required.</p>
<h3>To remove an integration instance from Home Assistant <a class="title-link" name="to-remove-an-integration-instance-from-home-assistant" href="#to-remove-an-integration-instance-from-home-assistant"></a>
</h3>
<ol>
<li>Go to <a href="https://my.home-assistant.io/redirect/integrations" class="my" target="_blank"><strong>Settings</strong> &gt; <strong>Devices &amp; services</strong></a> and select the integration card.</li>
<li>From the list of devices, select the integration instance you want to remove.</li>
<li>Next to the entry, select the three dots <iconify-icon inline icon="mdi:dots-vertical" title="Dots vertical"></iconify-icon> menu. Then, select <strong>Delete</strong>.</li>
</ol>
<h2>Capabilities <a class="title-link" name="capabilities" href="#capabilities"></a>
</h2>
<p>This integration offers various entities depending on the configuration of your Enphase system. The Envoy can communicate with Enphase IQ micro-inverters, Enphase ACB and IQ batteries, Enphase Ensemble Enpower switch and load shedding relays, Enphase compatible generators and the IQ Meter Collar.</p>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<ul>
<li>
<p>You may know referred product names under other names from the past or future.</p>
</li>
<li>
<p>In this documentation, the term SN is used for a device serial-number placeholder. Entities will contain the actual serial-number of the device.</p>
</li>
</ul>
</div>


</div>
<h3>Solar production data <a class="title-link" name="solar-production-data" href="#solar-production-data"></a>
</h3>
<p>All Envoy models with solar inverters, with or without installed production <abbr title="current transformers">CT</abbr>, for all firmware versions, report solar current and historical production data.</p>
<h4>Aggregated production data <a class="title-link" name="aggregated-production-data" href="#aggregated-production-data"></a>
</h4>
<p>The Envoy device reports aggregated data for all connected micro-inverters.</p>
<h5>Production sensor entities <a class="title-link" name="production-sensor-entities" href="#production-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Current power production</strong>: Current aggregated inverter power production in W.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Energy production last seven days</strong>: Energy produced in previous 7 days, not including today’s, in Wh, display scaled to kWh. (See known limitations <a href="#energy-incorrect">Energy Incorrect</a>). This entity is not logged in statistics.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Energy production today</strong>: Energy produced since midnight in Wh, default display scaled to kWh. (See known limitations <a href="#late-reset">Late reset</a>, <a href="#energy-incorrect">Energy Incorrect</a>).</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime energy production</strong>: Lifetime energy production in Wh, default display scaled to MWh. (See known limitations <a href="#lifetime-reset">Lifetime reset</a>).</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_solar_production.png" alt="Envoy device">
  <figcaption>Envoy device with solar production entities.</figcaption>
</figure>
<p>When used with <a href="#ct-aggregate-and-phase-data">multiphase CT phase data</a>, disabled phase entities are available as well.</p>
<h4>Individual micro-inverter production data <a class="title-link" name="individual-micro-inverter-production-data" href="#individual-micro-inverter-production-data"></a>
</h4>
<p>The Envoy reports individual micro-inverter device production data. SN is the micro-inverter serial-number.</p>
<h5>Sensor entities <a class="title-link" name="sensor-entities" href="#sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr></strong>: Current power generated by the inverter in W.</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> last reported</strong>: Time when Envoy last received a data update from the inverter. Typical update rate for an inverter to the Envoy is every 5 to 15 minutes. This entity is disabled by default for all inverters.</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Lifetime maximum power</strong>: Maximum power production measured by the inverter (W). This entity is disabled by default for all inverters.</li>
</ul>
<p>Based on the Envoy firmware version, the Envoy may provide inverter device data as well. If that is the case, additional entities are available. These are disabled by default for all inverters. Enable these as desired.</p>
<ul>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> DC voltage</strong>: DC voltage measured by the inverter (V).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> DC current</strong>: DC current measured by the inverter (A).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> AC voltage</strong>: AC voltage measured by the inverter (V).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> AC current</strong>: AC current measured by the inverter (A).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Frequency</strong>: Frequency measured by the inverter (Hz).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Temperature</strong>: Temperature measured by the inverter (°C).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Energy produced</strong>: Energy produced by the inverter during last report cycle (mWh).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Energy today</strong>: Energy produced today by the inverter (Wh).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Lifetime energy</strong>: Total energy produced during inverter lifetime (Wh).</li>
<li>
<strong>Inverter <abbr title="micro-inverter serial number">SN</abbr> Report duration</strong>: Time in seconds covered by the last report data.</li>
</ul>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<p>Due to a limitation in the Envoy firmware, the inverter device data is only available when 49 or fewer inverters are configured. When more than 49 inverters are configured, only the 3 power production entities are available for each inverter.</p>
  </div>
</div>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_inverter_device.png" alt="micro-inverter device">
  <figcaption>Micro-inverter device with solar production entities.</figcaption>
</figure>
<h3>House consumption data <a class="title-link" name="house-consumption-data" href="#house-consumption-data"></a>
</h3>
<p>House consumption data requires an Envoy Metered equipped and configured with at least 1 consumption <abbr title="current transformers"><a href="#current-transformers">CT</a></abbr>.</p>
<h4>Consumption Sensor Entities <a class="title-link" name="consumption-sensor-entities" href="#consumption-sensor-entities"></a>
</h4>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Current power consumption</strong>: Current power consumption in W.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime energy consumption</strong>: Lifetime energy consumption in Wh, default display scaled to MWh.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Energy consumption last seven days</strong>: Energy consumption in previous 7 days, not including today’s, in Wh, display scaled to kWh. (See known limitations <a href="#energy-incorrect">Energy Incorrect</a>) This entity is not logged in statistics.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Energy consumption today</strong>: Energy consumption since midnight in Wh, default display scaled to kWh. (See known limitations <a href="#energy-incorrect">Energy Incorrect</a>)</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_consumption.png" alt="consumption entities">
  <figcaption>Envoy metered with CT reporting production and consumption entities.</figcaption>
</figure>
<p>When used with <a href="#ct-aggregate-and-phase-data">multiphase CT phase data</a>, disabled phase entities are available but not shown. Enable as needed.</p>
<h3>Current Transformers <a class="title-link" name="current-transformers" href="#current-transformers"></a>
</h3>
<p>The Envoy Metered can be equipped with up-to 6 <abbr title="current transformers">CT</abbr>. These can be assigned to production, consumption and/or storage measurements in single or multiple phase setups.</p>
<p>The below diagram shows CT installation positions and how they are referred to.</p>
<ul>
<li>The production CT measures the energy exchange between Solar production and the switchboard.</li>
<li>If the consumption CT is installed as <strong>Load only</strong> a.k.a.  <strong>total-consumption</strong> it measures energy exchange from the switchboard to the loads/house.</li>
<li>If the consumption CT is installed as <strong>Load with Solar</strong> a.k.a. <strong>net-consumption</strong>, it measures energy exchange between the switchboard and the grid.</li>
<li>The storage CT measures the energy exchange between the battery storage and the switchboard.</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_ct_model.png" alt="ct model">
  <figcaption>Envoy current transformers.</figcaption>
</figure>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<p>This in no way represents a configuration direction, as actual configuration is driven by local rules, installer designs and Enphase installation guidelines. Variations may exist, based on specific needs or rules. This merely describes a simplified view and naming conventions used in this documentation to clarify integration operation. Refer to <a href="https://enphase.com/installers/resources/documentation/communication" rel="external nofollow">Enphase documentation<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> for more information.</p>
  </div>
</div>
<p>When an Envoy Metered is equipped with a production CT, the CT data will be used to provide the <a href="#aggregated-production-data">aggregated solar production data</a>. Likewise, the installed consumption CT will be the source for the <a href="#house-consumption-data">house consumption data</a>.</p>
<p>Either a net-consumption or a total-consumption CT is installed. The Envoy will calculate the data for the other one.</p>
<h4>CT Aggregate and phase data <a class="title-link" name="ct-aggregate-and-phase-data" href="#ct-aggregate-and-phase-data"></a>
</h4>
<p>When using <abbr title="current transformers"><a href="#current-transformers">CT</a></abbr> in multiphase enabled configurations, both aggregated and individual phase data is available. If only 1 phase is configured, phase data is the same as the aggregated data and no phase entities are created. If more than 1 phase is configured, disabled phase entities for each phase are created, enable them as needed.</p>
<p>Phase entity names are the names used for the aggregated entities, with the phase name in the post-fix. Phase names are <strong>L1</strong>, <strong>L2</strong>, <strong>L3</strong>. For example, once enabled, <a href="#solar-production-data"><strong>lifetime energy production</strong></a> on phase 3 is available as <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime energy production L3</strong>.</p>
<h4>Current transformer entities <a class="title-link" name="current-transformer-entities" href="#current-transformer-entities"></a>
</h4>
<p>CT measure multiple properties of the energy exchange which are available as Envoy device entities. These are all disabled by default, enable them as desired.</p>
<h5>Production CT sensor entities <a class="title-link" name="production-ct-sensor-entities" href="#production-ct-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Frequency production CT</strong>: Frequency in Hz.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Voltage production CT</strong>: Voltage in V. (see limitations <a href="#summed-voltage">Summed voltage</a>)</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Production CT current</strong>: Current in A.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Powerfactor production CT</strong>: Powerfactor, ratio of active to apparent power.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Metering status production CT</strong>: Status of the metering process: <code>normal</code>, <code>not-metering</code>, <code>check-wiring</code>.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Meter status flags active production CT</strong>: Count of CT status flags active. See troubleshooting <a href="#ct-active-flag-count-is-non-zero">CT Active flag count is non-zero</a> when non-zero.</li>
</ul>
<h5>Net-consumption CT sensor entities <a class="title-link" name="net-consumption-ct-sensor-entities" href="#net-consumption-ct-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Frequency net consumption CT</strong>: Frequency in Hz .</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Voltage net consumption CT</strong>: Voltage in V. (see limitations <a href="#summed-voltage">Summed voltage</a>
</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> net consumption CT current</strong>: Current in A.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Powerfactor net consumption CT</strong>: Power factor, ratio of active to apparent power.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Metering status net consumption CT</strong>: Status of the metering process: <code>normal</code>, <code>not-metering</code>, <code>check-wiring</code>.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Meter status flags active net consumption CT</strong>: Count of CT status flags active. See troubleshooting <a href="#ct-active-flag-count-is-non-zero">CT Active flag count is non-zero</a> when non-zero.</li>
</ul>
<h5>Storage CT sensor entities <a class="title-link" name="storage-ct-sensor-entities" href="#storage-ct-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Frequency storage CT</strong>: Frequency in Hz.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Voltage storage CT</strong>: Voltage in V. (see limitations <a href="#summed-voltage">Summed voltage</a>
</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> storage CT current</strong>: Current in A.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Powerfactor storage CT</strong>: Power factor, ratio of active to apparent power.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Metering status storage CT</strong>: Status of the metering process: <code>normal</code>, <code>not-metering</code>, <code>check-wiring</code>.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Meter status flags active storage CT</strong>: Count of CT status flags active. See troubleshooting <a href="#ct-active-flag-count-is-non-zero">CT Active flag count is non-zero</a> when non-zero.</li>
</ul>
<p>For storage CT energy entities refer to <a href="#aggregated-iq-battery-sensor-entities">battery sensor</a> description.</p>
<h3>Grid sensor entities <a class="title-link" name="grid-sensor-entities" href="#grid-sensor-entities"></a>
</h3>
<p>When the Envoy Metered is equipped with a <a href="#current-transformers">net-consumption CT</a>, entities for Grid import and export are available. See Limitations, <a href="#grid-importexport-values-incorrect">Grid Import/Export values incorrect</a> when using these.</p>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Current net power consumption</strong>: Current power exchange from (positive) / to (negative) the grid in W, default display in kW.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime net energy consumption</strong>: Lifetime energy consumed / imported from the grid in Wh, default display in MWh.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime net energy production</strong>: Lifetime energy produced / exported to the grid in Wh, default display in MWh.</li>
</ul>
<p>When using an IQ Metered Collar, the net-consumption CT’s are integrated in the collar.</p>
<p>When used with <a href="#ct-aggregate-and-phase-data">multiphase CT phase data</a>, disabled phase entities are available as well.</p>
<h4>Grid Balanced import/export sensor entities <a class="title-link" name="grid-balanced-importexport-sensor-entities" href="#grid-balanced-importexport-sensor-entities"></a>
</h4>
<p>When the Envoy Metered is equipped with a <a href="#current-transformers">total-consumption CT</a> instead of a <a href="#current-transformers">net-consumption CT</a>, no individual entities for Grid import and export are available, as these are not measured. Instead, the balance (difference) of grid import and export is available in a single entity, disabled by default, enable as desired.</p>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> balanced net power consumption</strong>: Current power exchange from (positive) / to (negative) the grid in W, default display in kW.
(This is the same value as <a href="#grid-sensor-entities">Envoy <abbr title="Envoy serial number">SN</abbr> Current net power consumption</a> when using a net-consumption CT.)</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime balanced net energy consumption</strong>: Lifetime energy balance (difference) of imported and exported grid energy in Wh, default display in kWh.</li>
</ul>
<p>When used with <a href="#ct-aggregate-and-phase-data">multiphase CT phase data</a>, disabled phase entities are available as well.</p>
<h3>Battery Storage data <a class="title-link" name="battery-storage-data" href="#battery-storage-data"></a>
</h3>
<p>Enphase battery systems of multiple generations and configurations can provide integration entity data.</p>
<ul>
<li>
<strong>AC-Batteries</strong>: first generation battery setup, no longer in production.</li>
<li>
<strong>IQ Batteries</strong>: current Enphase battery models.</li>
</ul>
<p>The batteries can be implemented in stand-alone configuration or as part of Enphase Ensemble systems with the Enpower/IQ System Controller.</p>
<h4>IQ battery data <a class="title-link" name="iq-battery-data" href="#iq-battery-data"></a>
</h4>
<h5>Aggregated IQ battery sensor entities <a class="title-link" name="aggregated-iq-battery-sensor-entities" href="#aggregated-iq-battery-sensor-entities"></a>
</h5>
<p>Aggregated IQ battery data includes all installed IQ Batteries.</p>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Battery</strong>: Current aggregated state of charge in %</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Available battery energy</strong>: Current aggregated IQ battery energy content in Wh</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Battery capacity</strong>: Aggregated maximum IQ battery energy content in Wh</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Reserve battery level</strong>: Configured aggregated IQ Battery backup state of charge in %</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Reserve battery energy</strong>: Configured aggregated IQ battery backup energy content in Wh</li>
</ul>
<p>If a <a href="#storage-ct-sensor-entities">storage <abbr title="current transformers">CT</abbr></a> is installed:</p>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Current battery discharge</strong>: Current power in/out of the battery in W.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime battery energy discharged</strong>: Lifetime energy discharged from the battery in Wh, default display format MWh.</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime battery energy charged</strong>: Lifetime energy charged in the battery in Wh, default display format MWh.</li>
</ul>
<figure id="aggregated-iq-battery-data">
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_aggr_iq_battery.png" alt="aggregated iq battery">
  <figcaption>Envoy Aggregated IQ battery Sensor entities with no <a href="#current-transformers">storage CT</a> nor <a href="#enpower-data">Enpower</a> installed.</figcaption>
</figure>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<p>If an Enpower device is installed, then <strong>Charge from grid</strong>, <strong>Reserve battery level</strong>, and <strong>Storage mode</strong> are available as <a href="#enpower-binary-sensor-entities">Enpower device entities</a> instead of Envoy device entities.</p>
  </div>
</div>
<h4>Individual IQ battery data <a class="title-link" name="individual-iq-battery-data" href="#individual-iq-battery-data"></a>
</h4>
<p>For each IQ Battery, an Encharge device is created, linked to the Envoy parent device. Each encharge devices offers individual battery sensors.</p>
<h5>Individual IQ battery sensor entities <a class="title-link" name="individual-iq-battery-sensor-entities" href="#individual-iq-battery-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Battery</strong>: Current state of charge of the battery in %</li>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Power</strong>: Current power in W</li>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Apparent Power</strong>: Current apparent power in VA</li>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Temperature</strong>: Current temperature in degrees C or F, based on your localization.</li>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Last reported</strong>: Time when Envoy received last update from the battery.</li>
</ul>
<h5>Individual IQ battery binary sensor entities <a class="title-link" name="individual-iq-battery-binary-sensor-entities" href="#individual-iq-battery-binary-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> Communicating</strong>: Communication status of encharge battery, Connected / Disconnected. This is a diagnostics entity.</li>
<li>
<strong>Encharge <abbr title="Encharge serial number">SN</abbr> DC Switch</strong>: DC Switched off status of encharge battery, On / Off. This is a diagnostics entity.</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_encharge.png" alt="iq battery">
  <figcaption>Envoy Encharge IQ battery sensor entities.</figcaption>
</figure>
<h4>AC-battery data <a class="title-link" name="ac-battery-data" href="#ac-battery-data"></a>
</h4>
<p>No individual AC-battery data is available, only aggregated AC-battery data for all AC-batteries.</p>
<h5>AC-battery sensor entities <a class="title-link" name="ac-battery-sensor-entities" href="#ac-battery-sensor-entities"></a>
</h5>
<ul>
<li>
<strong>ACB <abbr title="Envoy serial number">SN</abbr> Battery</strong>: Current AC-battery state of charge in %</li>
<li>
<strong>ACB <abbr title="Envoy serial number">SN</abbr> Battery state</strong>: AC-battery state: charging, idle, discharging</li>
<li>
<strong>ACB <abbr title="Envoy serial number">SN</abbr> Power</strong>: Current AC-battery power in W</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Available ACB battery energy</strong>: Current AC-battery energy content in Wh</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_acb_battery.png" alt="acb battery">
  <figcaption>Envoy AC-battery sensor entities.</figcaption>
</figure>
<h5>Aggregated IQ and AC battery sensor entities <a class="title-link" name="aggregated-iq-and-ac-battery-sensor-entities" href="#aggregated-iq-and-ac-battery-sensor-entities"></a>
</h5>
<p>If both IQ and AC batteries are used, aggregated battery data for all installed IQ batteries and AC batteries is available.</p>
<ul>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Aggregated Battery SOC</strong>: Overall aggregated battery state of charge in %</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Aggregated Available battery energy</strong>: Overall aggregated battery energy content in Wh</li>
<li>
<strong>Envoy <abbr title="Envoy serial number">SN</abbr> Aggregated Battery capacity</strong>: Overall aggregated maximum battery energy content in Wh</li>
</ul>
<p>The below figure shows the 3 aggregated entities along with the <a href="#ac-battery-sensor-entities">AC-battery energy</a> and 3 of the <a href="#aggregated-iq-battery-sensor-entities">IQ Battery aggregate</a> values.</p>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_aggr_acb_iq_battery.png" alt="aggregated acb iq battery">
  <figcaption>Envoy aggregated ACB and IQ battery sensor entities.</figcaption>
</figure>
<h3>Enpower data <a class="title-link" name="enpower-data" href="#enpower-data"></a>
</h3>
<p>Data for an installed Enphase Enpower off-grid enabling switch is available in various entities for an Enpower device.</p>
<h4>Enpower binary sensor entities <a class="title-link" name="enpower-binary-sensor-entities" href="#enpower-binary-sensor-entities"></a>
</h4>
<ul>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Grid status</strong>: status of the grid.</li>
</ul>
<h4>Enpower number entities <a class="title-link" name="enpower-number-entities" href="#enpower-number-entities"></a>
</h4>
<ul>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Reserve battery level</strong>: reserve battery level to maintain for outages in %. Changing the value, on the UI or in an <a href="#action-numberset_value">action</a>, will update the setting in the Envoy. Also see limitations, <a href="#no-battery-controls">No battery controls</a>.</li>
</ul>
<h4>Enpower select entities <a class="title-link" name="enpower-select-entities" href="#enpower-select-entities"></a>
</h4>
<ul>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Storage mode</strong>: Current configured storage mode, <code>Full backup</code>, <code>Self consumption</code>, <code>Savings mode</code>. Changing the selection, in the UI or in an <a href="#action-selectselect">action</a>, will update the setting in the Envoy. Also see limitations, <a href="#no-battery-controls">No battery controls</a>.</li>
</ul>
<h4>Enpower sensor entities <a class="title-link" name="enpower-sensor-entities" href="#enpower-sensor-entities"></a>
</h4>
<ul>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Temperature</strong>: Current temperature in degrees C or F, based on your localization.</li>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Last reported</strong>: Time when Envoy received last update from the enpower device.</li>
<li>
<strong>Enpower <abbr title="Encharge serial number">SN</abbr> Communicating</strong>: Communication status of enpower switch, Connected / Disconnected. This is a diagnostics entity.</li>
</ul>
<h4>Enpower switch entities <a class="title-link" name="enpower-switch-entities" href="#enpower-switch-entities"></a>
</h4>
<ul>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Charge from grid</strong>: Allow or disallow charging Encharge/IQ batteries from grid when a charge schedule is active. Changing the switch, in the UI or in an <a href="#action-switchturn_onswitchturn_offswitchtoggle">action</a>, will update the setting in the Envoy. If no charge schedule is active, changing the setting will not have an immediate effect. Also see limitations, <a href="#no-battery-controls">No battery controls</a>.</li>
<li>
<strong>Enpower <abbr title="Enpower serial number">SN</abbr> Grid enabled</strong>: Enable or disable grid connection. Note that the Enpower has a slight delay built-in between receiving these commands and actually switching the system on or off grid.</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_enpower.png" alt="envoy enpower">
  <figcaption>Envoy Enpower entities.</figcaption>
</figure>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<p>If no Enpower is installed, then <strong>Charge from grid</strong>, <strong>Reserve battery level</strong>, and <strong>Storage mode</strong> are available as <a href="#aggregated-iq-battery-data">Envoy device entities</a> instead of Enpower device entities.</p>
  </div>
</div>
<h3>Enpower load shedding relays <a class="title-link" name="enpower-load-shedding-relays" href="#enpower-load-shedding-relays"></a>
</h3>
<p>With the Enpower/IQ System Controller installed, entities for the state and control of the Enpower’s four load-shedding relays are available. In battery installations without load-shedding and off-grid functionality, used in many EU countries, these sensors and switches are not available.</p>
<p>The Enphase Enpower has 4 load shedding relays (volt-free contacts, often referred to as dry-contacts) that can be used to control non-essential loads in your home. These have two main modes of operation:</p>
<ul>
<li>
<p><strong>Standard</strong>: When the mode entity is set to standard, you can simply set the state of the relay to be powered or not powered for each mode of operation: on grid, off grid, and on generator.</p>
</li>
<li>
<p><strong>Battery level</strong>: When the relay mode is set to battery level, the relays will turn on and off based on the remaining battery level of your Encharge IQ batteries. Two number entities are available to control the cutoff and restore levels for the relays. When the battery level drops below the cutoff level, the relays will turn off, removing power from attached loads. When the battery level rises above the restore level, the relays will turn back on and restore power to attached loads.</p>
</li>
</ul>
<p>The names of entities and devices are derived from the load_name configured in the Enpower device.</p>
<h4>Dry-contact number entities <a class="title-link" name="dry-contact-number-entities" href="#dry-contact-number-entities"></a>
</h4>
<ul>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> cutoff battery level</strong>: battery level below which relay will turn off when in <code>Battery level</code> mode.</li>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> restore battery level</strong>: battery level above which the relay will turn back on when in <code>Battery level</code> mode.</li>
</ul>
<h4>Dry-contact select entities <a class="title-link" name="dry-contact-select-entities" href="#dry-contact-select-entities"></a>
</h4>
<ul>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> mode</strong>: dry-contact operational mode: <code>standard</code> or <code>battery</code>
</li>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> Grid action</strong>: dry-contact on grid action: <code>Powered</code>, <code>Not powered</code>, <code>Follow schedule</code>, <code>None</code>
</li>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> Micro-grid action</strong>: dry-contact on micro-grid action: <code>Powered</code>, <code>Not powered</code>, <code>Follow schedule</code>, <code>None</code>
</li>
<li>
<strong><abbr title="dry_contacts.load_name">LOAD_NAME</abbr> Generator action</strong>: dry-contact on generator action:  <code>Powered</code>, <code>Not powered</code>, <code>Follow schedule</code>, <code>None</code>
</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_dry_contact.png" alt="envoy dry-contact">
  <figcaption>Envoy Enpower dry-contact entities.</figcaption>
</figure>
<h3>IQ Meter Collar data <a class="title-link" name="iq-meter-collar-data" href="#iq-meter-collar-data"></a>
</h3>
<p>The IQ Meter Collar has the net-consumption CT integrated. The CT data is reported in the <a href="#net-consumption-ct-sensor-entities">net-consumption data</a> and <a href="#grid-sensor-entities">grid sensors</a>. In addition the status of the collar is available in entities.</p>
<h4>Collar status entities <a class="title-link" name="collar-status-entities" href="#collar-status-entities"></a>
</h4>
<ul>
<li>
<strong>Collar <abbr title="Collar serial number">SN</abbr> Grid state</strong>: Grid connection status, on_grid / off_grid / synchronizing / manual override active.</li>
<li>
<strong>Collar <abbr title="Collar serial number">SN</abbr> MID State</strong>: Status of enphase Microgrid Interconnection Device, open / close.</li>
<li>
<strong>Collar <abbr title="Collar serial number">SN</abbr> Temperature</strong>: Current temperature in degrees C or F, based on your localization.</li>
<li>
<strong>Collar <abbr title="Collar serial number">SN</abbr> Last reported</strong>: Time when Envoy received last update from the collar device.</li>
<li>
<strong>Collar <abbr title="Collar serial number">SN</abbr> Communicating</strong>: Communication status of the collar, Connected / Disconnected. This is a diagnostics entity.</li>
</ul>
<h3>C6 Combiner Controller data <a class="title-link" name="c6-combiner-controller-data" href="#c6-combiner-controller-data"></a>
</h3>
<p>The Enphase C6 combiner controller (C6CC) provides some status information to the Envoy which are available in entities.</p>
<h4>C6CC status entities <a class="title-link" name="c6cc-status-entities" href="#c6cc-status-entities"></a>
</h4>
<ul>
<li>
<strong>C6CC <abbr title="C6CC serial number">SN</abbr> Last reported</strong>: Time when Envoy received last update from the combiner device.</li>
<li>
<strong>C6CC <abbr title="C6CC serial number">SN</abbr> Communicating</strong>: Communication status of C6 Combiner, Connected / Disconnected. This is a diagnostics entity.</li>
</ul>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_collar_and_ccc_data.png" alt="envoy collar and c6cc">
  <figcaption>Envoy IQ Metered Collar and C6 Combiner Controller entities.</figcaption>
</figure>
<h2>Data polling interval <a class="title-link" name="data-polling-interval" href="#data-polling-interval"></a>
</h2>
<p>All data is collected in one coordinated collection cycle and sourced from a limited set of endpoints on the Envoy. For example, three different values sourced from the same endpoint are not pulled in three different requests but provided from the same single request. This method minimizes the number of requests to the Envoy. The local REST API of the Envoy is used. Only when the 1-year valid token is to expire, 1 month before due data, a new token is requested from the Enphase Enlighten website.</p>
<p>The integration collects data for all entities by default every 60 seconds. To customize the collection interval, refer to <a href="/common-tasks/general/#defining-a-custom-polling-interval">defining a custom polling interval</a>. Specify one single entity from the envoy device as target of the action using the <code>+ choose entity</code> button. Updating one entity will update all entities of the Envoy and the related devices like the inverters; there is no need to specify multiple or all entities or add (all) inverter entities. When using multiple Envoys, add one entity for each envoy as targets or create separate custom polling intervals with a single entity as needed.</p>
<p>Envoy installations without installed <abbr title="current transformers">CT</abbr>, collect individual solar inverter data every 5 minutes. This collection does not occur for each inverter at the same time in the 5-minute period. Shortening the collection interval will at best show updates for individual inverters quicker, but not yield more granular data.</p>
<p>With installed <abbr title="current transformers">CT</abbr>, data granularity increases and shortening the collection interval can provide more details. The Envoy, however, has no unlimited resources and shortening the collection interval may result in dropped connections, Envoy freeze or restarts. It will require some step-wise tuning for each individual situation.</p>
<h2>Credentials or device IP address update <a class="title-link" name="credentials-or-device-ip-address-update" href="#credentials-or-device-ip-address-update"></a>
</h2>
<p>This integration supports updating the Envoy configuration through a <code>reconfigure</code> menu option. The reconfiguration allows for changing the Envoy IP address, username, and/or password. Use this menu option if your Enlighten credentials or the device’s IP address has changed and needs to be manually updated. The latter is typically automatically detected and updated.</p>
<p>Use this menu option also when an Envoy firmware upgrade requires a switch from local Envoy username/password to token-based authentication with Enlighten username/password (refer to <a href="#required-manual-input">required manual input</a>).</p>
<h2>Firmware updates <a class="title-link" name="firmware-updates" href="#firmware-updates"></a>
</h2>
<p>The firmware version is read from the envoy when the configuration entry is loaded. The firmware version is then used in the process of determining capabilities and required authorization methods. The firmware version is available as the <code>sw_version</code> attribute of the configuration entry and shown on the device view of the envoy.</p>
<p>Every 4 hours, the actual firmware version in the Envoy is compared to the known one. If the actual version differs, the configuration entry is reloaded to effect any needed configuration changes. If the moment of the firmware update is known, a manual reload on the envoy configuration entry can be done to achieve the same.</p>
<p>The firmware version is not available as an entity, but rather as an attribute of the envoy. To use the firmware in automation, scripts or templates, use below example with any envoy entity.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml"><span class="pi">{{</span><span class="nv">device_attr(device_id('sensor.envoy_SN_current_power_production')</span><span class="pi">,</span><span class="s1">'</span><span class="s">sw_version'</span><span class="nv">)</span><span class="pi">}}</span>
</code></pre></div></div>
<h2>Energy dashboard <a class="title-link" name="energy-dashboard" href="#energy-dashboard"></a>
</h2>
<p>This integration provides several entities suitable for the energy dashboard.</p>
<h3>Solar panels <a class="title-link" name="solar-panels" href="#solar-panels"></a>
</h3>
<p>For <strong>Solar production</strong>, use the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime energy production</strong> entity. Overall this has proven to be more stable as the daily value reported by the Envoy. (See known limitations <a href="#late-reset">Late reset</a>, <a href="#energy-incorrect">Energy Incorrect</a>).</p>
<h3>Electricity grid <a class="title-link" name="electricity-grid" href="#electricity-grid"></a>
</h3>
<p>Whether there is data available to use with the electricity grid depends on the installed <abbr title="current transformers">CT</abbr>, if any. Also, see Limitations, <a href="#grid-importexport-values-incorrect">Grid Import/Export values incorrect</a> and <a href="#balancing-grid-meter">Balancing grid meter</a>.</p>
<h4>Electricity grid with net-consumption CT <a class="title-link" name="electricity-grid-with-net-consumption-ct" href="#electricity-grid-with-net-consumption-ct"></a>
</h4>
<p>With a <a href="#grid-sensor-entities">net-consumption CT</a> installed, both grid consumption and return to grid data is available. (Also, see <a href="#grid-importexport-values-incorrect">Limitations</a>)</p>
<ul>
<li>For <strong>Grid consumption</strong>, use the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime net energy consumption</strong> entity.</li>
<li>For <strong>Return to grid</strong>, use the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime net energy production</strong> entity.</li>
</ul>
<h4>Electricity grid with total-consumption CT <a class="title-link" name="electricity-grid-with-total-consumption-ct" href="#electricity-grid-with-total-consumption-ct"></a>
</h4>
<p>With a <a href="#grid-balanced-importexport-sensor-entities">total-consumption CT</a> installed, only the balanced grid import-export value is available. This value is not suited for direct use with the energy dashboard. It will require some templating to split the value into an import and export value.</p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>Concept to split balanced Grid value into individual import-export values</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_0">
<p>The concept is to track value changes of the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime balanced net energy consumption</strong> entity, add positive changes to a grid_import entity and add negative changes to a grid_export entity.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml">
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>
      <span class="na">entity_id</span><span class="pi">:</span> <span class="s">sensor.envoy_sn_lifetime_balanced_net_energy_consumption</span>
  
  <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Grid</span><span class="nv"> </span><span class="s">import"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_grid_import</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Wh"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">max)</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">energy</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">total_increasing</span> 
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Grid</span><span class="nv"> </span><span class="s">export"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_grid_export</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Wh"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">min)</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">energy</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">total_increasing</span>
</code></pre></div></div>
<p>The above example does not address handling <code>unavailable</code> or <code>unknown</code> states, value changes over Home Assistant outages nor changing UOM to a preferred one. Examples for these exist in various community topics.</p>
<div class="alert alert-tip">
  <p class="alert-title"><iconify-icon inline icon="mdi:lightbulb-outline"></iconify-icon> Tip</p>
  <div class="alert-content">
<p>Alternatively, this can be done by splitting the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> balanced net power consumption</strong> into power import and export and two Riemann sum integral helpers to calculate energy from the power values.</p>
  </div>
</div>
</div>
  </details>
</div>
<h3>Home battery storage <a class="title-link" name="home-battery-storage" href="#home-battery-storage"></a>
</h3>
<p>Whether there is data available to use with the electricity grid depends on the installed storage <abbr title="current transformers">CT</abbr>, if any.</p>
<h4>Home battery storage with storage CT <a class="title-link" name="home-battery-storage-with-storage-ct" href="#home-battery-storage-with-storage-ct"></a>
</h4>
<p>With a <a href="#aggregated-iq-battery-sensor-entities">storage CT</a> installed, data for both Energy coming out and going into the battery is available.</p>
<ul>
<li>For <strong>Energy going into the battery</strong>, use the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime battery energy charged</strong> entity.</li>
<li>For <strong>Energy coming out of the battery</strong>, use the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Lifetime battery energy discharged</strong> entity.</li>
</ul>
<h4>Home battery storage without storage CT <a class="title-link" name="home-battery-storage-without-storage-ct" href="#home-battery-storage-without-storage-ct"></a>
</h4>
<p>Without a <a href="#aggregated-iq-battery-sensor-entities">storage CT</a> installed, only the current Power in and out of individual batteries, or the current aggregated battery energy content is available. These values are not suited for direct use with the energy dashboard. It will require some templating to split the value into an import and export values.</p>
<h5>Home battery storage data using battery power <a class="title-link" name="home-battery-storage-data-using-battery-power" href="#home-battery-storage-data-using-battery-power"></a>
</h5>
<p>Battery power is the current power flow in or out of an individual battery. Using the summed Power values of all batteries, the result needs to be split in 2 entities, representing total power in and power out. Next, each entity needs to be integrated into energy, using two Riemann sum integral helpers. The resulting data can be used for Energy going into the battery and Energy coming out of the battery.</p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>Concept to split Battery power value into individual import-export power values</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_1">
<p>The concept is to first sum all battery Power values using a combine state helper. Then track value changes of the summed value entity, add positive changes to a battery_charge power entity and add negative changes to a battery_discharge power entity.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml">
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>
      <span class="na">entity_id</span><span class="pi">:</span> <span class="s">sensor.envoy_sn_summed_battery_power_entity</span>
  
  <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Battery</span><span class="nv"> </span><span class="s">charge</span><span class="nv"> </span><span class="s">power"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_battery_charge_power</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">W"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">max)</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">power</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">measurement</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Battery</span><span class="nv"> </span><span class="s">discharge</span><span class="nv"> </span><span class="s">power"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_battery_discharge_power</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">W"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">min)</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">power</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">measurement</span>
</code></pre></div></div>
<p>The above example does not address handling <code>unavailable</code> or <code>unknown</code> states, value changes over Home Assistant outages nor conversion losses.</p>
</div>
  </details>
</div>
<h5>Home battery storage data on the available battery energy <a class="title-link" name="home-battery-storage-data-on-the-available-battery-energy" href="#home-battery-storage-data-on-the-available-battery-energy"></a>
</h5>
<p>Changes in the Available battery energy are a result from Energy going in or out of the battery. Splitting these energy changes into 2 entities, one tracking positive changes, one the negative changes, results in data that can be used for Energy going into the battery and Energy coming out off the battery. This method does not account for conversion losses as Energy content changes do not exactly match actual energy flow in and out of the battery.</p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>Concept to split Available battery energy value into individual import-export values</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_2">
<p>The concept is to track value changes of the <strong>Envoy <abbr title="Envoy serial number">SN</abbr> Available battery energy</strong> entity, add positive changes to a battery_charge entity and add negative changes to a battery_discharge entity.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml">
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>
      <span class="na">entity_id</span><span class="pi">:</span> <span class="s">sensor.envoy_sn_available_battery_energy</span>
  
  <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Battery</span><span class="nv"> </span><span class="s">charge"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_battery_charge</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Wh"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">max</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">energy</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">total_increasing</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Battery</span><span class="nv"> </span><span class="s">discharge"</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">calculated_envoy_battery_discharge</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Wh"</span> 
      <span class="na">state</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">this.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">([0,</span><span class="nv"> </span><span class="s">(trigger.to_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">trigger.from_state.state</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int(0))]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">min</span><span class="nv"> </span><span class="s">}}"</span> 
      <span class="na">device_class</span><span class="pi">:</span> <span class="s">energy</span> 
      <span class="na">state_class</span><span class="pi">:</span> <span class="s">total_increasing</span>
</code></pre></div></div>
<p>The above example does not address handling <code>unavailable</code> or <code>unknown</code> states, value changes over Home Assistant outages nor conversion losses.</p>
</div>
  </details>
</div>
<h3>Individual devices <a class="title-link" name="individual-devices" href="#individual-devices"></a>
</h3>
<p>Although not a replacement for individual energy or power measurement devices, with multiphase CT installed, <a href="#ct-aggregate-and-phase-data">energy consumption for phases</a> is available. These can be used for individual devices, if of interest.</p>
<h2>Actions <a class="title-link" name="actions" href="#actions"></a>
</h2>
<p>Available actions are: <code>switch.turn_on</code>, <code>switch.turn_off</code>, <code>switch.toggle</code>, <a href="#action-numberset_value"><code>number.set_value</code></a>, <a href="#action-selectselect"><code>select.select</code></a></p>
<h3>Action switch.turn_on/switch.turn_off/switch.toggle <a class="title-link" name="action-switchturn_onswitchturn_offswitchtoggle" href="#action-switchturn_onswitchturn_offswitchtoggle"></a>
</h3>
<p>These actions turn on, off or toggle</p>
<ul>
<li>the Enpower device switches <code>grid_enabled</code>, <code>charge_from_grid</code>
</li>
<li>the <a href="#enpower-load-shedding-relays">Enpower load shedding relays</a> switch.</li>
</ul>
<table>
<thead>
<tr>
<th>Data attribute</th>
<th>Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entity_id</code></td>
<td>no</td>
<td>Name(s) of entities. For example, <code>switch.enpower_12345678901001_grid_enabled</code>.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml"><span class="na">action</span><span class="pi">:</span> <span class="s">switch.toggle</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">switch.enpower_12345678901001_grid_enabled</span>
<span class="na">data</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="na">action</span><span class="pi">:</span> <span class="s">switch.turn_on</span>
<span class="na">data</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">switch.no2</span>
    <span class="pi">-</span> <span class="s">switch.nc2</span>
</code></pre></div></div>
<h3>Action number.set_value <a class="title-link" name="action-numberset_value" href="#action-numberset_value"></a>
</h3>
<p>This action changes the setting for the Enpower <code>Reserve battery level</code>.</p>
<table>
<thead>
<tr>
<th>Data attribute</th>
<th>Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entity_id</code></td>
<td>no</td>
<td>Name(s) of entities. For example, <code>number.enpower_12345678901001_reserve_battery_level</code>.</td>
</tr>
<tr>
<td><code>value</code></td>
<td>no</td>
<td>The target value between 0 and 100 to set Enpower reserve battery level to.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml"><span class="na">action</span><span class="pi">:</span> <span class="s">number.set_value</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span> <span class="s">number.enpower_12345678901001_reserve_battery_level</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">25"</span>
</code></pre></div></div>
<h3>Action select.select <a class="title-link" name="action-selectselect" href="#action-selectselect"></a>
</h3>
<p>This action changes the:</p>
<ul>
<li>Relays relay_mode, grid_action, micro_grid_action or generator_action</li>
<li>Battery storage mode</li>
</ul>
<table>
<thead>
<tr>
<th>Data attribute</th>
<th>Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entity_id</code></td>
<td>no</td>
<td>Name(s) of entities. For example, <code>select.nc2_generator_action</code>.</td>
</tr>
<tr>
<td><code>option</code></td>
<td>no</td>
<td>For relay modes: <code>powered</code>, <code>not_powered</code>, <code>schedule</code>, <code>none</code>. <br> For storage modes: <code>backup</code>, <code>self_consumption</code>, <code>savings</code>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="yaml"><span class="na">action</span><span class="pi">:</span> <span class="s">select.select_option</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">select.nc2_generator_action</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">option</span><span class="pi">:</span> <span class="s">not_powered</span>

<span class="na">action</span><span class="pi">:</span> <span class="s">select.select_option</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">select.enpower_12345678901001_storage_mode</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">option</span><span class="pi">:</span> <span class="s">backup</span>
</code></pre></div></div>
<div class="alert alert-note">
  <p class="alert-title"><iconify-icon inline icon="mdi:information-outline"></iconify-icon> Note</p>
  <div class="alert-content">
<p>Technically <code>select.first</code>, <code>select.last</code>, <code>select.previous</code>, <code>select.next</code> are available as well, but as there’s no logical sequence in the values to select, their use is not advocated.</p>
  </div>
</div>
<h2>Known issues and limitations <a class="title-link" name="known-issues-and-limitations" href="#known-issues-and-limitations"></a>
</h2>
<h3>Firmware changes <a class="title-link" name="firmware-changes" href="#firmware-changes"></a>
</h3>
<p><a href="https://enphase.com/installers/resources/documentation/communication?&amp;f%5B0%5D=document%3A217" rel="external nofollow">Envoy firmware<iconify-icon inline="true" icon="tabler:external-link" class="external-link"></iconify-icon></a> versions come with changing behavior, features, and potential issues. Firmware is pushed to the Envoy by Enphase, while ‘not always communicated in detail upfront’. This may result in sudden changes in the Envoy behavior and is always accompanied by an outage while Envoy is being updated.</p>
<h3>No battery controls <a class="title-link" name="no-battery-controls" href="#no-battery-controls"></a>
</h3>
<p>As of Envoy firmware 8.2.4225, the Envoy no longer supports the following operations through the local REST API used by Home Assistant:</p>
<ul>
<li>Setting battery modes</li>
<li>Enabling/disabling charging from the grid</li>
<li>Changing reserve battery level</li>
</ul>
<p>Until a resolution is found, you must use the Enphase App to control these features.</p>
<h3>Late reset <a class="title-link" name="late-reset" href="#late-reset"></a>
</h3>
<p>Not all firmware versions reset <code>Energy production today</code> or <code>Energy consumption today</code>, <code>Energy production last seven days</code> and <code>Energy consumption last seven days</code> at midnight. A 1 hour delay is reported. In this case, best use a utility meter with the ‘Lifetime’ entity for daily reporting. This seems to be daylight savings time change related and surfaced in recent firmware versions. Some older firmware versions would reset up to 15 minutes late, even outside daylight saving periods.</p>
<h3>Energy incorrect <a class="title-link" name="energy-incorrect" href="#energy-incorrect"></a>
</h3>
<p>When using Envoy Metered with <abbr title="current transformers">CT</abbr></p>
<ul>
<li>not all firmware versions report <code>Energy production today</code> and/or <code>Energy consumption today</code> correctly. Zero data, changes to a lower value and unexpected spikes have been reported. Enphase reportedly indicated it is an issue in summing phase values to aggregated data. In this case, either use individual phase data or a utility meter with the <code>Lifetime energy production</code> or <code>Lifetime energy consumption</code> entity for daily reporting.</li>
<li>not all firmware versions report <code>Energy production last seven days</code> and/or <code>Energy consumption last seven days</code> correctly. Zero and unexpected values have been reported. Enphase reportedly indicated it is an issue in summing phase values to aggregated data. In this case, use the individual phase data.</li>
<li>
<code>Energy production today</code> and <code>Energy consumption today</code> have been reported not to reset to zero. Instead, it resets to a non-zero value that seems to gradually increase over time, although other values have been reported as well. This issue has also been reported as starting suddenly overnight. For daily reporting, it is recommended to use a utility meter with the <code>Lifetime energy production</code> or <code>Lifetime energy consumption</code> entity.</li>
</ul>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>History examples for Today's energy production value not resetting to zero</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_3">
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_production_non_zero_reset.png" alt="envoy today non zero reset">
  <figcaption>Envoy Today's energy production value exhibits a daily reset to an ever increasing non-zero value.</figcaption>
</figure>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_production_non_zero_reset_step_change.png" alt="envoy today step change">
  <figcaption>Envoy Today's energy production value exhibits a sudden onset of non-zero resets.</figcaption>
</figure>
</div>
  </details>
</div>
<p>These issues may result in log entries like:</p>
<div class="language-txt highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="txt">Entity sensor.envoy_123456789012_energy_consumption_today from integration enphase_envoy has state class total_increasing, but its state is not strictly increasing. Triggered by state 12.345 (12.543) with last_updated set to 2025-09-05T18:00:23.432536+00:00. Please create a bug report at ...
</code></pre></div></div>
<p>If these entries occur frequently and are a nuisance then disable the entity. It’s data is at best doubtful.</p>
<h3>Lifetime reset <a class="title-link" name="lifetime-reset" href="#lifetime-reset"></a>
</h3>
<p>Envoy Metered without installed CT, running older firmware versions, reportedly resets <strong>Lifetime energy production</strong> to 0 when reaching 1.2 MWh. For use with the energy dashboard, the reset is not an issue. In a recent firmware version 8.x.x the reset is solved, but results in a one-time step change to the full lifetime value. This has impact on the energy dashboard, it can be solved by setting the statistics value for that moment to 0 in  <a href="/docs/tools/dev-tools/#statistics-tab">Developer Tools: Statistics</a></p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>History example for Envoy Lifetime energy production value reset</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_4">
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_production_reset.png" alt="envoy dry-contact">
  <figcaption>Envoy Lifetime energy production value reset.</figcaption>
</figure>
</div>
  </details>
</div>
<h3>Lifetime energy production decreases by 1.2 MWh <a class="title-link" name="lifetime-energy-production-decreases-by-12-mwh" href="#lifetime-energy-production-decreases-by-12-mwh"></a>
</h3>
<p>Envoy Standard (not Metered), running firmware 8.2.4264, reportedly decreases the <strong>Lifetime energy production</strong> value by 1.2 MWh at irregular times. The current hypothesis is that the step change occurs when one of the inverters exceeds an internal lifetime joules counter of 32 bit, which is 1.19 MWh, and resets to zero. This leads to a decrease of 1.2 MWh in the aggregated value for all inverters. It’s not clear if this also happens for the metered Envoy.</p>
<div class="details-block">
  <details class="details-block-item">
    <summary class="details-block-title">
      <span>History example for Envoy Lifetime energy production value decrease</span>
      <div class="details-block-arrow">
      <svg class="down" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
      <svg class="up" width="24" height="24" viewbox="0 0 24 24"><path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"></path></svg>
      </div>
    </summary>
    <div class="details-block-content" id="content_5">
<p>The example below shows decreases when multiple inverters reach a 1.2 MWh lifetime value over time. This would typically occur after some year(s) lifetime and then spread over some months based on individual solar panel production variations.</p>
<figure>
  <img src="/needlehack-blog/images/integrations/enphase_envoy/enphase_envoy_production_decrease.png" alt="envoy lifetime energy production decrease">
  <figcaption>Envoy Lifetime energy production value decrease.</figcaption>
</figure>
</div>
  </details>
</div>
<h3>Missing inverter data <a class="title-link" name="missing-inverter-data" href="#missing-inverter-data"></a>
</h3>
<p>If you are not seeing all your installed <a href="#sensor-entities">inverters</a>, and you have more than 49 inverters installed, and you are running HA 2025.7, 2025.7.1, or 2025.7.2, then upgrade HA to 2025.7.3 or newer. Due to a limitation in the Envoy firmware. Only the inverter details for 49 inverters are available. In the mentioned releases, any more inverters got dropped. The 2025.7.3 version fixed this by only using the inverter base data, which does not have this limitation.</p>
<h3>Missing inverter details <a class="title-link" name="missing-inverter-details" href="#missing-inverter-details"></a>
</h3>
<p>If you are not seeing <a href="#sensor-entities">inverters</a> detail data, verify if you have more than 49 inverters installed. Due to a limitation in the Envoy firmware, the inverter device detail data is only available when 49 or fewer inverters are configured. When more than 49 inverters are configured, only the 3 power production entities are available for each inverter.</p>
<h3>Summed Voltage <a class="title-link" name="summed-voltage" href="#summed-voltage"></a>
</h3>
<p>The Envoy Metered in multiphase setup, sums the voltages of the phases measured on the CT for the aggregated data. This may be valid for split-phase, but for 3-phase systems, use the individual phases rather than the summed value.</p>
<h3>Grid Import/Export values incorrect <a class="title-link" name="grid-importexport-values-incorrect" href="#grid-importexport-values-incorrect"></a>
</h3>
<p>Envoy Metered with a net-consumption CT measures current and energy exchange between switchboard and grid. Mismatches with other grid-meters and/or the Enphase web-site have been reported. It’s not clear if this is related to a recent firmware version or longer existing. When using these values best validate if they are correct in your specific case.</p>
<h3>Balancing grid meter <a class="title-link" name="balancing-grid-meter" href="#balancing-grid-meter"></a>
</h3>
<p>In multiphase installations with batteries, in countries with phase-balancing grid meters, the battery will export to the grid on one phase the amount it lacks on another phase. This other phase pulls the missing amount from the grid, as if it is using the grid as a ‘transport’ between phases. Since the grid meter will balance the amount imported and exported on the two phases, the net result is zero. The Envoy multiphase net-consumption CTs, however, will report the amounts on both phases, resulting in too high export on one and too high import on the other. One may consider using the <code>lifetime balanced net energy consumption</code> which is the sum of grid import and export to eliminate this effect. This would require some templating to split these values into import and export values. Alternatively, use the <code>current net power consumption</code> or <code>balanced net power consumption</code> with a Riemann integral sum helper.</p>
<h2>Troubleshooting <a class="title-link" name="troubleshooting" href="#troubleshooting"></a>
</h2>
<h3>Periodic network connection issues <a class="title-link" name="periodic-network-connection-issues" href="#periodic-network-connection-issues"></a>
</h3>
<p>If you experience periodic connection issues, ensure the Envoy is connected to only one interface (either Ethernet OR Wi-Fi, not both). The Envoy should not be both on your local LAN (Ethernet) and local Wi-Fi simultaneously. Having both connections active can cause auto-discovery to alternate between interfaces, resulting in connection interruptions approximately every 30 minutes.</p>
<h3>CT Active flag count is non-zero <a class="title-link" name="ct-active-flag-count-is-non-zero" href="#ct-active-flag-count-is-non-zero"></a>
</h3>
<p>The <strong>CT active flag count</strong> value shows the number of CT status flags that are raised. In a normal state, the value of <strong>CT active flag count</strong> is zero. If the value is non-zero, consult the <a href="#diagnostics">diagnostic</a> report of the Envoy and look for <code>raw_data</code> - <code>/ivp/meters</code> - <code>statusFlags</code> for set flags, one or more from  (<code>production-imbalance</code> | <code>negative-production</code> | <code>power-on-unused-phase</code> | <code>negative-total-consumption</code>). Their somewhat descriptive names may be an indication of installation issues.</p>
<h3>Log entry for state is not strictly increasing <a class="title-link" name="log-entry-for-state-is-not-strictly-increasing" href="#log-entry-for-state-is-not-strictly-increasing"></a>
</h3>
<p>The log shows an entry like below for energy consumption today or energy production today. See the <a href="#energy-incorrect">energy incorrect</a> topic for a description of this issue.</p>
<div class="language-txt highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="txt">Entity sensor.envoy_123456789012_energy_consumption_today from integration enphase_envoy has state class total_increasing, but its state is not strictly increasing. Triggered by state 12.345 (12.543) with last_updated set to 2025-09-05T18:00:23.432536+00:00. Please create a bug report at ...
</code></pre></div></div>
<h3>Debug logs and diagnostics <a class="title-link" name="debug-logs-and-diagnostics" href="#debug-logs-and-diagnostics"></a>
</h3>
<p>This integration provides debug log and <span class="terminology">diagnostics<span class="terminology-tooltip">The diagnostics integration provides a way to download diagnostic data from a device or integration for sharing in issue reports. Sharing diagnostics data when reporting an issue allows developers to diagnose and fix your reported problem quicker.<a class="terminology-link" href="/integrations/diagnostics"> [Learn more]</a></span></span> report as described in the <a href="/docs/configuration/troubleshooting/#debug-logs-and-diagnostics">Home Assistant troubleshooting pages</a>.</p>
<h4>Debug log <a class="title-link" name="debug-log" href="#debug-log"></a>
</h4>
<p>When experiencing issues during the use of the integration, enable the debug log for the <abbr title="IQ Gateway">Envoy</abbr>. Then restart the integration. This will add details on the data collection to the Home Assistant log file. Leave the debug log enabled long enough to capture the occurrence of the issue. If the issue is intermittent, this may take a while and it may grow the log file quite a bit.</p>
<p>If you’re expecting features to show but they are not shown, make sure to reload the integration while debug logging is enabled.
When this integration is loaded, it will scan the <abbr title="IQ Gateway">Envoy</abbr> for available features and configure these as needed. Following this initial scan, only data for the found features is collected.  Performing a reload with debug enabled results in the debug log containing the initial full scan to assist with analyzing any missing features. Some features are disabled by default, and you need to enable them if you want them to show. Verify this before starting a debug session.</p>
<p>Once the issue occurred, stop the debug logging again (<em>download of debug log file will start automatically</em>). When reporting the issue, include the debug log file as well as a <a href="#diagnostics"><span class="terminology">diagnostics<span class="terminology-tooltip">The diagnostics integration provides a way to download diagnostic data from a device or integration for sharing in issue reports. Sharing diagnostics data when reporting an issue allows developers to diagnose and fix your reported problem quicker.<a class="terminology-link" href="/integrations/diagnostics"> [Learn more]</a></span></span></a> file.</p>
<p>The debug log will show all communication with the Envoy / IQ Gateway. Lines starting with below examples are log entries for the integration:</p>
<div class="language-txt highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="txt">2024-03-07 11:20:11.897 DEBUG (MainThread) [homeassistant.components.enphase_envoy
2024-03-07 11:20:11.898 DEBUG (MainThread) [pyenphase
</code></pre></div></div>
<p>Below a typical data request / reply sequence in the log file. These lines will contain the data details received from the <abbr title="IQ Gateway">Envoy</abbr>.</p>
<div class="language-txt highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="txt">... [pyenphase.envoy] Requesting https://192.168.1.2/ivp/meters with timeout ...
... [pyenphase.envoy] Request reply from https://192.168.1.2/ivp/meters status 200:...
</code></pre></div></div>
<p>The end of a collection cycle is marked by:</p>
<div class="language-txt highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="txt">... [homeassistant.components.enphase_envoy.coordinator] Finished fetching Envoy 123456 data in 1.234 seconds (success: True)
</code></pre></div></div>
<h4>Diagnostics <a class="title-link" name="diagnostics" href="#diagnostics"></a>
</h4>
<p>The <span class="terminology">diagnostics<span class="terminology-tooltip">The diagnostics integration provides a way to download diagnostic data from a device or integration for sharing in issue reports. Sharing diagnostics data when reporting an issue allows developers to diagnose and fix your reported problem quicker.<a class="terminology-link" href="/integrations/diagnostics"> [Learn more]</a></span></span> data file is a JSON file and includes a <code>data</code> section with the details for this integration. The file can be viewed with any text editor. The data section has up to 6 major subsections which reflect how the integration is set up and data is used. Include the file when reporting issues.</p>
<p>Below the 6 subsections, each collapsed.</p>
<div class="language-JSON highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="JSON">  "data": {
    "config_entry": { ...
    },
    "envoy_properties": { ...
    },
    "raw_data": { ...
    },
    "envoy_model_data": { ...
    },
    "envoy_entities_by_device": [ ...
    ],
    "fixtures" : { ...
    }
  }
}    
</code></pre></div></div>
<h5>Config entry <a class="title-link" name="config-entry" href="#config-entry"></a>
</h5>
<p>Shows the integration configuration created when the integration was added.</p>
<h5>Envoy properties <a class="title-link" name="envoy-properties" href="#envoy-properties"></a>
</h5>
<p>Shows the conclusions of the initial data scan and what features were identified, including the detected firmware version in the Envoy.</p>
<h5>Raw data <a class="title-link" name="raw-data" href="#raw-data"></a>
</h5>
<p>Shows the data collected from the Envoy during the last data scan when the diagnostic report was created. If in doubt about data shown in the dashboards, consult this section to find the raw data sent by the Envoy. The integration is not modifying this data, it’s just providing the data to the entities.</p>
<h5>Envoy model data <a class="title-link" name="envoy-model-data" href="#envoy-model-data"></a>
</h5>
<p>Shows the data of the Envoy extracted from the raw_data into Envoy class data used by the Home Assistant integration. This is a subset of the full raw dataset.</p>
<h5>Envoy entities by device <a class="title-link" name="envoy-entities-by-device" href="#envoy-entities-by-device"></a>
</h5>
<p>Shows all entities created by the integration based on the findings of the initial scan, grouped by device. Entity state based on the last data collection cycle is included. State values here come from the Envoy model data and are the values visible in the dashboards.</p>
<h5>Fixtures <a class="title-link" name="fixtures" href="#fixtures"></a>
</h5>
<p>The data to build test fixtures from. This section is only available when the option to Collect test fixture data is enabled in the integration <a href="#options">options</a>.</p>
<hr>


  


  
<div class="material-card text feedback">
  <h4>
<iconify-icon inline icon="mdi:feedback" title="Feedback"></iconify-icon> <b> Help us improve our documentation</b><a href="#feedback_section" class="title-link" name="feedback_section"></a>
</h4>
  Suggest an edit to this page, or provide/view feedback for this page.
  <div class="links">
    <ul aria-label="Page feedback options">
    <li><a href="https://github.com/home-assistant/home-assistant.io/tree/current/source/_integrations/enphase_envoy.markdown" target="_blank" title="Edit this page"><iconify-icon inline icon="mdi:edit"></iconify-icon> Edit</a></li>
    
    <li><a href="https://github.com/home-assistant/home-assistant.io/issues/new?template=feedback.yml&amp;url=https%3A%2F%2Fivangrod.github.io%2Fintegrations%2Fenphase_envoy%2F&amp;version=2025.9.4&amp;labels=current,integration%3A%20enphase_envoy" target="_blank" title="Provide feedback on this page"><iconify-icon inline icon="mdi:comment-edit-outline"></iconify-icon> Provide feedback</a></li>
    <li><a href="https://github.com/home-assistant/home-assistant.io/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3A%22integration%3A+enphase_envoy%22" target="_blank" title="View pending feedback for this page"><iconify-icon inline icon="mdi:comment-text-multiple-outline"></iconify-icon> View pending feedback</a></li>
    
  </ul>
  </div>
</div>


</article>

            
          </div>


          
            
              <aside id="integration-sidebar" class="grid__item one-third desk-wide-one-quarter lap-one-whole palm-one-whole">
              
            <div class="grid">
  




  


<section class="aside-module grid__item one-whole lap-one-half">
  <div class='brand-logo-container section'>
      <img src='https://brands.home-assistant.io/_/enphase_envoy//logo.png' srcset='https://brands.home-assistant.io/_/enphase_envoy/logo@2x.png 2x' /><a href='https://my.home-assistant.io/redirect/config_flow_start?domain=enphase_envoy' class='my badge' target='_blank'><img src='https://my.home-assistant.io/badges/config_flow_start.svg' /></a></div>

  <div class='section'>The Enphase Envoy  integration  was introduced in Home Assistant 0.76, and it's used by <a title="Open analytics.home-assistant.io" href="https://analytics.home-assistant.io/integrations" target="_blank" rel="noopener">
        
          1.7%</a> of the active installations.
        
      
    
  </div>
    <div class='section'>
      <iconify-icon icon='mdi:download-network-outline'></iconify-icon>&nbsp;Its IoT class is <a href='/blog/2016/02/12/classifying-the-internet-of-things/#classifiers'>Local Polling.</a>
    </div>
  <div class='section'>
    <a href='/docs/quality_scale/#-platinum'>🏆 Platinum quality</a><br /></div>
  <div class='section'>
    <a href="https://github.com/home-assistant/core/tree/dev/homeassistant/components/enphase_envoy" target="_blank"><iconify-icon inline icon='simple-icons:github' title='Github'></iconify-icon> View source on GitHub</a><br />
    <a href="https://github.com/home-assistant/core/issues?q=is%3Aissue+is%3Aopen+label%3A%22integration%3A+enphase_envoy%22" target="_blank"><iconify-icon inline icon='mdi:bug' title='Bug'></iconify-icon> View known issues</a>
  </div></section>

<section class="aside-module grid__item one-whole lap-one-half">
  <div class='section'>
    <h1 class="title epsilon"><iconify-icon inline icon='mdi:person-heart' title='Person heart'></iconify-icon> Integration owners</h1>
    
        
        

          
          <div class="section">
            We are incredibly grateful to the following contributors who currently maintain this integration:<br />
          </div>
          <div class="section"><a href="https://github.com/bdraco" target="_blank"><img class="codeowner-avatar" src="https://avatars.githubusercontent.com/bdraco?size=96" alt="@bdraco"/> @bdraco</a><br /><a href="https://github.com/cgarwood" target="_blank"><img class="codeowner-avatar" src="https://avatars.githubusercontent.com/cgarwood?size=96" alt="@cgarwood"/> @cgarwood</a><br /><a href="https://github.com/joostlek" target="_blank"><img class="codeowner-avatar" src="https://avatars.githubusercontent.com/joostlek?size=96" alt="@joostlek"/> @joostlek</a><br /><a href="https://github.com/catsmanac" target="_blank"><img class="codeowner-avatar" src="https://avatars.githubusercontent.com/catsmanac?size=96" alt="@catsmanac"/> @catsmanac</a><br /></div>
        
    
  </div>
</section>






  <section id="toc-module" class="aside-module grid__item one-whole lap-one-half">
        <div class='section'>
          <h1 class="title epsilon"><iconify-icon inline icon='mdi:toc' title='Toc'></iconify-icon> On this page</h1>
          <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#supported-devices">Supported devices</a></li>
<li class="toc-entry toc-h2"><a href="#unsupported-devices">Unsupported devices</a></li>
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#configuration">Configuration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#required-manual-input">Required Manual input</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#options">Options</a></li>
<li class="toc-entry toc-h2"><a href="#reconfigure">Reconfigure</a></li>
<li class="toc-entry toc-h2"><a href="#removing-the-integration">Removing the integration</a>
<ul>
<li class="toc-entry toc-h3"><a href="#to-remove-an-integration-instance-from-home-assistant">To remove an integration instance from Home Assistant</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#capabilities">Capabilities</a>
<ul>
<li class="toc-entry toc-h3"><a href="#solar-production-data">Solar production data</a></li>
<li class="toc-entry toc-h3"><a href="#house-consumption-data">House consumption data</a></li>
<li class="toc-entry toc-h3"><a href="#current-transformers">Current Transformers</a></li>
<li class="toc-entry toc-h3"><a href="#grid-sensor-entities">Grid sensor entities</a></li>
<li class="toc-entry toc-h3"><a href="#battery-storage-data">Battery Storage data</a></li>
<li class="toc-entry toc-h3"><a href="#enpower-data">Enpower data</a></li>
<li class="toc-entry toc-h3"><a href="#enpower-load-shedding-relays">Enpower load shedding relays</a></li>
<li class="toc-entry toc-h3"><a href="#iq-meter-collar-data">IQ Meter Collar data</a></li>
<li class="toc-entry toc-h3"><a href="#c6-combiner-controller-data">C6 Combiner Controller data</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#data-polling-interval">Data polling interval</a></li>
<li class="toc-entry toc-h2"><a href="#credentials-or-device-ip-address-update">Credentials or device IP address update</a></li>
<li class="toc-entry toc-h2"><a href="#firmware-updates">Firmware updates</a></li>
<li class="toc-entry toc-h2"><a href="#energy-dashboard">Energy dashboard</a>
<ul>
<li class="toc-entry toc-h3"><a href="#solar-panels">Solar panels</a></li>
<li class="toc-entry toc-h3"><a href="#electricity-grid">Electricity grid</a></li>
<li class="toc-entry toc-h3"><a href="#home-battery-storage">Home battery storage</a></li>
<li class="toc-entry toc-h3"><a href="#individual-devices">Individual devices</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#actions">Actions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#action-switchturn_onswitchturn_offswitchtoggle">Action switch.turn_on/switch.turn_off/switch.toggle</a></li>
<li class="toc-entry toc-h3"><a href="#action-numberset_value">Action number.set_value</a></li>
<li class="toc-entry toc-h3"><a href="#action-selectselect">Action select.select</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#known-issues-and-limitations">Known issues and limitations</a>
<ul>
<li class="toc-entry toc-h3"><a href="#firmware-changes">Firmware changes</a></li>
<li class="toc-entry toc-h3"><a href="#no-battery-controls">No battery controls</a></li>
<li class="toc-entry toc-h3"><a href="#late-reset">Late reset</a></li>
<li class="toc-entry toc-h3"><a href="#energy-incorrect">Energy incorrect</a></li>
<li class="toc-entry toc-h3"><a href="#lifetime-reset">Lifetime reset</a></li>
<li class="toc-entry toc-h3"><a href="#lifetime-energy-production-decreases-by-12-mwh">Lifetime energy production decreases by 1.2 MWh</a></li>
<li class="toc-entry toc-h3"><a href="#missing-inverter-data">Missing inverter data</a></li>
<li class="toc-entry toc-h3"><a href="#missing-inverter-details">Missing inverter details</a></li>
<li class="toc-entry toc-h3"><a href="#summed-voltage">Summed Voltage</a></li>
<li class="toc-entry toc-h3"><a href="#grid-importexport-values-incorrect">Grid Import/Export values incorrect</a></li>
<li class="toc-entry toc-h3"><a href="#balancing-grid-meter">Balancing grid meter</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#troubleshooting">Troubleshooting</a>
<ul>
<li class="toc-entry toc-h3"><a href="#periodic-network-connection-issues">Periodic network connection issues</a></li>
<li class="toc-entry toc-h3"><a href="#ct-active-flag-count-is-non-zero">CT Active flag count is non-zero</a></li>
<li class="toc-entry toc-h3"><a href="#log-entry-for-state-is-not-strictly-increasing">Log entry for state is not strictly increasing</a></li>
<li class="toc-entry toc-h3"><a href="#debug-logs-and-diagnostics">Debug logs and diagnostics</a></li>
</ul>
</li>
</ul>
        </div>
      </section><section id="category-module" class="aside-module grid__item one-whole lap-one-half">
      <div class='section'>
        <h1 class="title epsilon"><iconify-icon inline icon='mdi:category' title='Category'></iconify-icon> Categories</h1>
        <ul class='divided'><li>
            <a href='/integrations/#energy'>Energy</a>
          </li></ul>
      </div>
    </section></div>

          </aside>
          
        </div>
      </div>

      <footer>
        <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="skyline grid">
        <div class="skyline grid__item one-whole">
          <div class="footer-skyline">
          </div>
        </div>
      </div>
      <div class="footer-nav grid">
        <div class="company grid__item one-quarter lap-one-half palm-one-whole">
          <div class="title">
            <img
              src="/needlehack-blog/images/footer-logo-text.svg"
              height="72"
              alt="Home Assistant"
            />
          </div>
          <p>
            Home Assistant is a project from the <a href="https://www.openhomefoundation.org/">Open Home Foundation</a>, sponsored by <a href="https://www.nabucasa.com/">Nabu Casa</a>.
          </p>
        </div>

        <div class="grid__item one-quarter lap-one-half palm-one-whole">
          <h3>Join us and contribute!</h3>
          <ul>
            <li><a class="external-link" href="https://github.com/home-assistant/">GitHub repo <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://developers.home-assistant.io">Developers Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://design.home-assistant.io">Design Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://data.home-assistant.io">Data Science Portal <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://community.home-assistant.io">Community Forum <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://creators.home-assistant.io/">Creator Network <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a class="external-link" href="https://works-with.home-assistant.io/">Works With Home Assistant <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></li>
            <li><a href="/needlehack-blog/community">Our community</li>
            <li><a href="/needlehack-blog/help/reporting_issues/">Reporting issues</a></li>
          </ul>
          <h3>System status</h3>
          <ul>
            <li>
              <a class="external-link"  href="https://alerts.home-assistant.io">Integration Alerts <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a>
            </li>
            <li><a href="/needlehack-blog/security/">Security Alerts</a></li>
            <li>
              <a class="external-link" href="https://status.home-assistant.io">System Status <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a>
            </li>
          </ul>
        </div>

        <div class="grid__item one-quarter lap-one-half palm-one-whole">
          <h3>Companion apps</h3>
          <ul>
            <li><a class="external-link" href="https://apps.apple.com/us/app/home-assistant/id1099568401">iOS and Apple devices</a></li>
            <li><a class="external-link" href="https://play.google.com/store/apps/details?id=io.homeassistant.companion.android">Android and Wear OS</a></li>
            <li><a class="external-link" href="https://companion.home-assistant.io/">...and more!</a></li>
          </ul>
          <h3>Governance</h3>
          <ul>
            <li><a href="/needlehack-blog/privacy/">Privacy Notices</a></li>
            <li><a href="/needlehack-blog/developers/cla/">Contributor License Agreement</a></li>
            <li><a href="/needlehack-blog/tos/">Terms of Service</a></li>
            <li><a href="/needlehack-blog/code_of_conduct/">Code of Conduct</a></li>
            <li><a href="/needlehack-blog/developers/credits/">Credits</a></li>
            <li><a href="/needlehack-blog/developers/license/">License</a></li>
          </ul>
        </div>

        <div class="socials grid__item one-quarter lap-one-half palm-one-whole">

          <h3>Follow us</h3>
          <p><a class="external-link" href='https://newsletter.openhomefoundation.org/#/portal'>Sign up for our newsletter <iconify-icon inline icon='tabler:external-link' title='External link'></iconify-icon></a></p>
          <div class="icons">
            <a
              rel="me"
              href="https://youtube.com/@home_assistant"
              title="YouTube"
              target="_blank"
              ><iconify-icon icon="simple-icons:youtube"></iconify-icon></a>
            <a
              rel="me"
              href="https://reddit.com/r/homeassistant"
              title="Reddit"
              target="_blank"
              ><iconify-icon icon="simple-icons:reddit"></iconify-icon></a>
            <a
              rel="me"
              href="https://github.com/home-assistant/home-assistant"
              title="GitHub"
              target="_blank"
              ><iconify-icon icon="simple-icons:github"></iconify-icon></a>
            <br />
            <a
              rel="me"
              href="https://fosstodon.org/@homeassistant"
              title="Mastodon"
              target="_blank"
              ><iconify-icon icon="simple-icons:mastodon"></iconify-icon></a>
            <a
              rel="me"
              href="https://bsky.app/profile/home-assistant.io"
              title="Bluesky"
              target="_blank"
             ><iconify-icon icon="simple-icons:bluesky"></iconify-icon></a>
            <a
              rel="me"
              href="https://x.com/home_assistant"
              title="X"
              target="_blank"
             ><iconify-icon icon="simple-icons:x"></iconify-icon></a>
            <br />
            <a
              rel="me"
              href="https://www.facebook.com/homeassistantio"
              title="Facebook"
              target="_blank"
              ><iconify-icon icon="simple-icons:facebook"></iconify-icon></a>
            <a
              rel="me"
              href="https://www.instagram.com/homeassistant/"
              title="Instagram"
              target="_blank"
              ><iconify-icon icon="simple-icons:instagram"></iconify-icon></a>
            <a
              rel="me"
              href="https://www.linkedin.com/company/home-assistant"
              title="LinkedIn"
              target="_blank"
              ><iconify-icon icon="simple-icons:linkedin"></iconify-icon></a>
          </div>

          <div class="web-notice">
            <p>
              For partnership inquiries please check out <a href="https://works-with.home-assistant.io/">Works With Home Assistant</a>. For media, get in touch <a href="mailto:media@openhomefoundation.org">here</a>. For other questions, you can contact us <a href="mailto:hello@home-assistant.io">here</a> (No technical support!)
            </p>
            <p>
              Website powered by <a href="https://jekyllrb.com/">Jekyll</a><br />
              Originally based on the <a href="https://github.com/coogie/oscailte">Oscailte theme</a>
            </p>
            <a href="https://www.netlify.com">
              <img
                src="/needlehack-blog/images/frontpage/netlify.svg"
                alt="Deploys by Netlify Badge"
              />
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

      </footer>

    </div>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1.3.1/lite-youtube.js"></script>

<script src="/needlehack-blog/javascripts/terminology_tooltip.js" type="text/javascript" defer></script>

<script src="/needlehack-blog/javascripts/prism.js" type="text/javascript" defer></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3/dist/umd/index.min.js"></script>
<script type="text/javascript">
  docsearch({
    container: '#docsearch',
    appId: 'FBHBYS3J0U',
    indexName: 'home-assistant',
    apiKey: "ba6f7e6d97b3d3d2f778978c742a47c6",
  });
  document.querySelector('.site-title').addEventListener('contextmenu', function (ev) {
    ev.preventDefault();
    document.location.assign("https://design.home-assistant.io/#brand/logo")
  });
</script>




<script type="text/javascript">
  {
    const article = document.querySelector("article.post");
    if (article) {
      const iframes = article.querySelectorAll("iframe[data-src]");
      let loaded = false;
      if (iframes) {
        document.addEventListener('mousemove', loadLazyFrames, { passive: true, once: true });
        document.addEventListener('touchmove', loadLazyFrames, { passive: true, once: true });
        document.addEventListener('scroll', loadLazyFrames, { passive: true, once: true });
  
        function loadLazyFrames() {
          if (loaded) return;
          loaded = true;
  
          iframes.forEach((iframe) => {
            const src = iframe.getAttribute("data-src");
            if (src) {
              iframe.setAttribute("src", src);
              iframe.removeAttribute("data-src");
            }
          });
        }
      }
    }
  }
</script>

  </body>
</html>
